{% comment %}
  Outputs product swatch data as JSON for use in JavaScript

  Usage:
  /products/HANDLE?view=swatches
{% endcomment %}
{%- layout none -%}
{%- liquid
  assign product_handle = product.handle | default: ''
-%}
{%- if product_handle == blank -%}
{}
{%- else -%}
{"options_with_values":[
{%- for option in product.options_with_values -%}
  {%- if forloop.first == false -%},{%- endif -%}
  {
    "name":{{ option.name | json }},
    "position":{{ option.position | json }},
    "values":[
    {%- for value in option.values -%}
      {%- if forloop.first == false -%},{%- endif -%}
      {
        "value":{{ value | json }},
        {%- if value.swatch -%}
        "swatch":{
          {%- if value.swatch.color -%}
          "color":{"rgb":"{{ value.swatch.color.rgb }}"}
          {%- elsif value.swatch.image -%}
          "image":{"src":"{{ value.swatch.image | image_url: width: 50 }}"}
          {%- endif -%}
        }
        {%- else -%}
        "swatch":null
        {%- endif -%}
      }
    {%- endfor -%}
    ]
  }
{%- endfor -%}
]}
{%- endif -%}
