{%- comment -%}
  SNIPPET: size-chart-new.liquid
  Minimalist Zara-inspired size guide drawer - Clean black & white design
{%- endcomment -%}

{%- if product -%}
  {%- assign _scope_id = section.id | default: block.id | default: product.id -%}
  {%- assign sg_id = 'sg-' | append: product.id | append: '-' | append: _scope_id -%}

  {%- assign sizechart_key = '' -%}
  {%- for tag in product.tags -%}
    {%- assign tag_lower = tag | downcase | strip -%}
    {%- if tag_lower == 'camisola' or tag_lower == 'camisolas' or tag_lower == 't-shirt' or tag_lower == 't-shirts' or tag_lower == 'tshirt' or tag_lower == 'tshirts' or tag_lower == 'sweatshirt' or tag_lower == 'sweatshirts' or tag_lower == 'tops' or tag_lower == 'bodies' or tag_lower == 'blusa' or tag_lower == 'blusas' or tag_lower == 'camisa' or tag_lower == 'camisas' -%}
      {%- assign sizechart_key = 'tops' -%}
      {%- break -%}
    {%- elsif tag_lower == 'saia' or tag_lower == 'saias' -%}
      {%- assign sizechart_key = 'saia' -%}
      {%- break -%}
    {%- elsif tag_lower == 'saia-calção' or tag_lower == 'saias-calção' -%}
      {%- assign sizechart_key = 'saia-calcao' -%}
      {%- break -%}
    {%- elsif tag_lower == 'calcas' or tag_lower == 'calças' or tag_lower == 'jeans' or tag_lower == 'calças de ganga' -%}
      {%- assign sizechart_key = 'calcas' -%}
      {%- break -%}
    {%- elsif tag_lower == 'calção' or tag_lower == 'calções' -%}
      {%- assign sizechart_key = 'calcoes' -%}
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}

  {%- comment -%} Load metafields if available {%- endcomment -%}
  {%- assign has_metafield_product = false -%}
  {%- assign has_metafield_body = false -%}
  {%- assign has_metafield_instructions = false -%}

  {%- if product.metafields.custom.size_guide_product != blank -%}
    {%- assign has_metafield_product = true -%}
    {%- assign metafield_product = product.metafields.custom.size_guide_product.value | default: product.metafields.custom.size_guide_product -%}
  {%- endif -%}

  {%- if product.metafields.custom.size_guide_body != blank -%}
    {%- assign has_metafield_body = true -%}
    {%- assign metafield_body = product.metafields.custom.size_guide_body.value | default: product.metafields.custom.size_guide_body -%}
  {%- endif -%}

  {%- if product.metafields.custom.size_guide_instructions != blank -%}
    {%- assign has_metafield_instructions = true -%}
    {%- assign metafield_instructions = product.metafields.custom.size_guide_instructions.value | default: product.metafields.custom.size_guide_instructions -%}
  {%- endif -%}

  <div id="sg-wrap-{{ sg_id }}" class="sg-wrap">
    <div class="sg-root" id="{{ sg_id }}" hidden role="dialog" aria-modal="true" aria-label="Guia de tamanhos">
      <div class="sg-overlay" data-sg-close></div>
      <aside class="sg-panel" tabindex="-1">

        <!-- Header -->
        <header class="sg-header">
          <h2 class="sg-title">GUIA DE TAMANHOS</h2>
          <button class="sg-close" type="button" data-sg-close aria-label="Fechar">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="square">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </header>

        <!-- Tab Navigation -->
        <div class="sg-tabs" role="tablist">
          <button class="sg-tab sg-tab--active" role="tab" aria-selected="true" aria-controls="sg-panel-measurements-{{ sg_id }}" id="sg-tab-measurements-{{ sg_id }}" data-tab="measurements">
            MEDIDAS DO ARTIGO
          </button>
          <button class="sg-tab" role="tab" aria-selected="false" aria-controls="sg-panel-body-{{ sg_id }}" id="sg-tab-body-{{ sg_id }}" data-tab="body">
            MEDIDAS CORPORAIS
          </button>
        </div>

        <!-- Tab Panel: Measurements -->
        <div class="sg-tab-panel sg-tab-panel--active" role="tabpanel" id="sg-panel-measurements-{{ sg_id }}" aria-labelledby="sg-tab-measurements-{{ sg_id }}" data-panel="measurements">

          <!-- Size Selector -->
          {%- if has_metafield_product or sizechart_key != '' -%}
            <div class="sg-size-selector">
              <div class="sg-size-buttons" role="radiogroup">
                {%- if has_metafield_product -%}
                  {%- for size in metafield_product.sizes -%}
                    <button class="sg-size-btn {% if forloop.first %}sg-size-btn--active{% endif %}" role="radio" aria-checked="{% if forloop.first %}true{% else %}false{% endif %}" data-size="{{ size }}">{{ size }}</button>
                  {%- endfor -%}
                {%- else -%}
                  <button class="sg-size-btn sg-size-btn--active" role="radio" aria-checked="true" data-size="S">S</button>
                  <button class="sg-size-btn" role="radio" aria-checked="false" data-size="M">M</button>
                  <button class="sg-size-btn" role="radio" aria-checked="false" data-size="L">L</button>
                  <button class="sg-size-btn" role="radio" aria-checked="false" data-size="XL">XL</button>
                  <button class="sg-size-btn" role="radio" aria-checked="false" data-size="XXL">XXL</button>
                {%- endif -%}
              </div>
            </div>
          {%- endif -%}

          <!-- Product Image -->
          <div class="sg-media">
            {%- assign first_media = product.featured_media | default: product.media.first -%}
            {%- if first_media -%}
              <img class="sg-img"
                   alt="{{ first_media.alt | default: product.title | escape }}"
                   loading="lazy"
                   src="{{ first_media | image_url: width: 600 }}"
                   srcset="{{ first_media | image_url: width: 400 }} 400w, {{ first_media | image_url: width: 600 }} 600w"
                   sizes="(max-width: 740px) 200px, 300px">
            {%- endif -%}
          </div>

          <!-- Measurement Table -->
          <div class="sg-table-container">
            {%- if has_metafield_product -%}
              {%- comment -%} Use metafield data {%- endcomment -%}
              <table class="sg-table">
                <thead>
                  <tr>
                    <th>MEDIDA</th>
                    {%- for size in metafield_product.sizes -%}
                      <th data-size="{{ size }}">{{ size }}</th>
                    {%- endfor -%}
                  </tr>
                </thead>
                <tbody>
                  {%- for measurement in metafield_product.measurements -%}
                    <tr>
                      <td class="sg-table-label">{{ measurement.label }}</td>
                      {%- for value in measurement.values -%}
                        <td data-size="{{ metafield_product.sizes[forloop.index0] }}">{{ value }}</td>
                      {%- endfor -%}
                    </tr>
                  {%- endfor -%}
                </tbody>
              </table>
            {%- else -%}
              {%- comment -%} Use tag-based default data {%- endcomment -%}
              {%- case sizechart_key -%}

                {%- when 'tops' -%}
                <table class="sg-table">
                  <thead>
                    <tr>
                      <th>MEDIDA</th>
                      <th data-size="S">S</th>
                      <th data-size="M">M</th>
                      <th data-size="L">L</th>
                      <th data-size="XL">XL</th>
                      <th data-size="XXL">XXL</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="sg-table-label">Peito</td>
                      <td data-size="S">50 cm</td>
                      <td data-size="M">53 cm</td>
                      <td data-size="L">56 cm</td>
                      <td data-size="XL">59 cm</td>
                      <td data-size="XXL">62 cm</td>
                    </tr>
                    <tr>
                      <td class="sg-table-label">Comprimento</td>
                      <td data-size="S">70 cm</td>
                      <td data-size="M">72 cm</td>
                      <td data-size="L">74 cm</td>
                      <td data-size="XL">76 cm</td>
                      <td data-size="XXL">78 cm</td>
                    </tr>
                    <tr>
                      <td class="sg-table-label">Manga</td>
                      <td data-size="S">20 cm</td>
                      <td data-size="M">21 cm</td>
                      <td data-size="L">22 cm</td>
                      <td data-size="XL">23 cm</td>
                      <td data-size="XXL">24 cm</td>
                    </tr>
                  </tbody>
                </table>

              {%- when 'saia' -%}
              <table class="sg-table">
                <thead>
                  <tr>
                    <th>MEDIDA</th>
                    <th data-size="S">S</th>
                    <th data-size="M">M</th>
                    <th data-size="L">L</th>
                    <th data-size="XL">XL</th>
                    <th data-size="XXL">XXL</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="sg-table-label">Cintura</td>
                    <td data-size="S">68 cm</td>
                    <td data-size="M">72 cm</td>
                    <td data-size="L">76 cm</td>
                    <td data-size="XL">80 cm</td>
                    <td data-size="XXL">84 cm</td>
                  </tr>
                  <tr>
                    <td class="sg-table-label">Anca</td>
                    <td data-size="S">88 cm</td>
                    <td data-size="M">92 cm</td>
                    <td data-size="L">96 cm</td>
                    <td data-size="XL">100 cm</td>
                    <td data-size="XXL">104 cm</td>
                  </tr>
                  <tr>
                    <td class="sg-table-label">Comprimento</td>
                    <td data-size="S">40 cm</td>
                    <td data-size="M">41 cm</td>
                    <td data-size="L">42 cm</td>
                    <td data-size="XL">43 cm</td>
                    <td data-size="XXL">44 cm</td>
                  </tr>
                </tbody>
              </table>

              {%- when 'saia-calcao' -%}
              <table class="sg-table">
                <thead>
                  <tr>
                    <th>MEDIDA</th>
                    <th data-size="S">S</th>
                    <th data-size="M">M</th>
                    <th data-size="L">L</th>
                    <th data-size="XL">XL</th>
                    <th data-size="XXL">XXL</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="sg-table-label">Cintura</td>
                    <td data-size="S">68 cm</td>
                    <td data-size="M">72 cm</td>
                    <td data-size="L">76 cm</td>
                    <td data-size="XL">80 cm</td>
                    <td data-size="XXL">84 cm</td>
                  </tr>
                  <tr>
                    <td class="sg-table-label">Anca</td>
                    <td data-size="S">88 cm</td>
                    <td data-size="M">92 cm</td>
                    <td data-size="L">96 cm</td>
                    <td data-size="XL">100 cm</td>
                    <td data-size="XXL">104 cm</td>
                  </tr>
                  <tr>
                    <td class="sg-table-label">Comprimento</td>
                    <td data-size="S">36 cm</td>
                    <td data-size="M">37 cm</td>
                    <td data-size="L">38 cm</td>
                    <td data-size="XL">39 cm</td>
                    <td data-size="XXL">40 cm</td>
                  </tr>
                </tbody>
              </table>

              {%- when 'calcas' -%}
              <table class="sg-table">
                <thead>
                  <tr>
                    <th>MEDIDA</th>
                    <th data-size="S">S</th>
                    <th data-size="M">M</th>
                    <th data-size="L">L</th>
                    <th data-size="XL">XL</th>
                    <th data-size="XXL">XXL</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="sg-table-label">Cintura</td>
                    <td data-size="S">72 cm</td>
                    <td data-size="M">76 cm</td>
                    <td data-size="L">80 cm</td>
                    <td data-size="XL">84 cm</td>
                    <td data-size="XXL">88 cm</td>
                  </tr>
                  <tr>
                    <td class="sg-table-label">Anca</td>
                    <td data-size="S">92 cm</td>
                    <td data-size="M">96 cm</td>
                    <td data-size="L">100 cm</td>
                    <td data-size="XL">104 cm</td>
                    <td data-size="XXL">108 cm</td>
                  </tr>
                  <tr>
                    <td class="sg-table-label">Comprimento</td>
                    <td data-size="S">100 cm</td>
                    <td data-size="M">102 cm</td>
                    <td data-size="L">104 cm</td>
                    <td data-size="XL">106 cm</td>
                    <td data-size="XXL">108 cm</td>
                  </tr>
                </tbody>
              </table>

              {%- when 'calcoes' -%}
              <table class="sg-table">
                <thead>
                  <tr>
                    <th>MEDIDA</th>
                    <th data-size="S">S</th>
                    <th data-size="M">M</th>
                    <th data-size="L">L</th>
                    <th data-size="XL">XL</th>
                    <th data-size="XXL">XXL</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="sg-table-label">Cintura</td>
                    <td data-size="S">72 cm</td>
                    <td data-size="M">76 cm</td>
                    <td data-size="L">80 cm</td>
                    <td data-size="XL">84 cm</td>
                    <td data-size="XXL">88 cm</td>
                  </tr>
                  <tr>
                    <td class="sg-table-label">Anca</td>
                    <td data-size="S">92 cm</td>
                    <td data-size="M">96 cm</td>
                    <td data-size="L">100 cm</td>
                    <td data-size="XL">104 cm</td>
                    <td data-size="XXL">108 cm</td>
                  </tr>
                  <tr>
                    <td class="sg-table-label">Comprimento</td>
                    <td data-size="S">42 cm</td>
                    <td data-size="M">44 cm</td>
                    <td data-size="L">46 cm</td>
                    <td data-size="XL">48 cm</td>
                    <td data-size="XXL">50 cm</td>
                  </tr>
                </tbody>
              </table>

                {%- else -%}
                <div class="sg-empty">
                  <p>Sem tabela específica para este produto.</p>
                </div>
              {%- endcase -%}
            {%- endif -%}
          </div>

          <!-- Note -->
          <p class="sg-note">As medidas podem apresentar pequenas variações devido ao processo de produção.</p>
        </div>

        <!-- Tab Panel: Body Measurements -->
        <div class="sg-tab-panel" role="tabpanel" id="sg-panel-body-{{ sg_id }}" aria-labelledby="sg-tab-body-{{ sg_id }}" data-panel="body">

          <!-- Size Selector for Body -->
          {%- if has_metafield_body or sizechart_key != '' -%}
            <div class="sg-size-selector">
              <div class="sg-size-buttons" role="radiogroup">
                {%- if has_metafield_body -%}
                  {%- for size in metafield_body.sizes -%}
                    <button class="sg-size-btn-body {% if forloop.first %}sg-size-btn-body--active{% endif %}" role="radio" aria-checked="{% if forloop.first %}true{% else %}false{% endif %}" data-size-body="{{ size }}">{{ size }}</button>
                  {%- endfor -%}
                {%- else -%}
                  <button class="sg-size-btn-body sg-size-btn-body--active" role="radio" aria-checked="true" data-size-body="S">S</button>
                  <button class="sg-size-btn-body" role="radio" aria-checked="false" data-size-body="M">M</button>
                  <button class="sg-size-btn-body" role="radio" aria-checked="false" data-size-body="L">L</button>
                  <button class="sg-size-btn-body" role="radio" aria-checked="false" data-size-body="XL">XL</button>
                  <button class="sg-size-btn-body" role="radio" aria-checked="false" data-size-body="XXL">XXL</button>
                {%- endif -%}
              </div>
            </div>
          {%- endif -%}

          <!-- Body Measurement Table -->
          <div class="sg-table-container">
            {%- if has_metafield_body -%}
              {%- comment -%} Use metafield data {%- endcomment -%}
              <table class="sg-table">
                <thead>
                  <tr>
                    <th>MEDIDA</th>
                    {%- for size in metafield_body.sizes -%}
                      <th data-size-body="{{ size }}">{{ size }}</th>
                    {%- endfor -%}
                  </tr>
                </thead>
                <tbody>
                  {%- for measurement in metafield_body.measurements -%}
                    <tr>
                      <td class="sg-table-label">{{ measurement.label }}</td>
                      {%- for value in measurement.values -%}
                        <td data-size-body="{{ metafield_body.sizes[forloop.index0] }}">{{ value }}</td>
                      {%- endfor -%}
                    </tr>
                  {%- endfor -%}
                </tbody>
              </table>
            {%- else -%}
              {%- comment -%} Use tag-based default data {%- endcomment -%}
              {%- case sizechart_key -%}

                {%- when 'tops' -%}
                <table class="sg-table">
                  <thead>
                    <tr>
                      <th>MEDIDA</th>
                      <th data-size-body="S">S</th>
                      <th data-size-body="M">M</th>
                      <th data-size-body="L">L</th>
                      <th data-size-body="XL">XL</th>
                      <th data-size-body="XXL">XXL</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="sg-table-label">Peito</td>
                      <td data-size-body="S">82-86 cm</td>
                      <td data-size-body="M">87-91 cm</td>
                      <td data-size-body="L">92-96 cm</td>
                      <td data-size-body="XL">97-101 cm</td>
                      <td data-size-body="XXL">102-106 cm</td>
                    </tr>
                    <tr>
                      <td class="sg-table-label">Cintura</td>
                      <td data-size-body="S">62-66 cm</td>
                      <td data-size-body="M">67-71 cm</td>
                      <td data-size-body="L">72-76 cm</td>
                      <td data-size-body="XL">77-81 cm</td>
                      <td data-size-body="XXL">82-86 cm</td>
                    </tr>
                    <tr>
                      <td class="sg-table-label">Anca</td>
                      <td data-size-body="S">88-92 cm</td>
                      <td data-size-body="M">93-97 cm</td>
                      <td data-size-body="L">98-102 cm</td>
                      <td data-size-body="XL">103-107 cm</td>
                      <td data-size-body="XXL">108-112 cm</td>
                    </tr>
                  </tbody>
                </table>

              {%- when 'saia' or 'saia-calcao' -%}
              <table class="sg-table">
                <thead>
                  <tr>
                    <th>MEDIDA</th>
                    <th data-size-body="S">S</th>
                    <th data-size-body="M">M</th>
                    <th data-size-body="L">L</th>
                    <th data-size-body="XL">XL</th>
                    <th data-size-body="XXL">XXL</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="sg-table-label">Cintura</td>
                    <td data-size-body="S">62-66 cm</td>
                    <td data-size-body="M">67-71 cm</td>
                    <td data-size-body="L">72-76 cm</td>
                    <td data-size-body="XL">77-81 cm</td>
                    <td data-size-body="XXL">82-86 cm</td>
                  </tr>
                  <tr>
                    <td class="sg-table-label">Anca</td>
                    <td data-size-body="S">88-92 cm</td>
                    <td data-size-body="M">93-97 cm</td>
                    <td data-size-body="L">98-102 cm</td>
                    <td data-size-body="XL">103-107 cm</td>
                    <td data-size-body="XXL">108-112 cm</td>
                  </tr>
                </tbody>
              </table>

              {%- when 'calcas' or 'calcoes' -%}
              <table class="sg-table">
                <thead>
                  <tr>
                    <th>MEDIDA</th>
                    <th data-size-body="S">S</th>
                    <th data-size-body="M">M</th>
                    <th data-size-body="L">L</th>
                    <th data-size-body="XL">XL</th>
                    <th data-size-body="XXL">XXL</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="sg-table-label">Cintura</td>
                    <td data-size-body="S">68-72 cm</td>
                    <td data-size-body="M">73-77 cm</td>
                    <td data-size-body="L">78-82 cm</td>
                    <td data-size-body="XL">83-87 cm</td>
                    <td data-size-body="XXL">88-92 cm</td>
                  </tr>
                  <tr>
                    <td class="sg-table-label">Anca</td>
                    <td data-size-body="S">88-92 cm</td>
                    <td data-size-body="M">93-97 cm</td>
                    <td data-size-body="L">98-102 cm</td>
                    <td data-size-body="XL">103-107 cm</td>
                    <td data-size-body="XXL">108-112 cm</td>
                  </tr>
                </tbody>
              </table>

                {%- else -%}
                <div class="sg-empty">
                  <p>Sem tabela específica para este produto.</p>
                </div>
              {%- endcase -%}
            {%- endif -%}
          </div>

          <!-- How to Measure Guide -->
          <div class="sg-guide-section">
            <h3 class="sg-guide-title">COMO MEDIR</h3>
            <div class="sg-guide-content">
              {%- if has_metafield_instructions -%}
                {%- comment -%} Use metafield instructions {%- endcomment -%}
                {%- for step in metafield_instructions.steps -%}
                  <div class="sg-guide-item">
                    <div class="sg-guide-label">{{ step.title }}</div>
                    <p>{{ step.description }}</p>
                  </div>
                {%- endfor -%}
              {%- else -%}
                {%- comment -%} Use tag-based default instructions {%- endcomment -%}
                {%- case sizechart_key -%}
                {%- when 'tops' -%}
                <div class="sg-guide-item">
                  <div class="sg-guide-label">Peito</div>
                  <p>Medir a circunferência do peito na parte mais ampla, abaixo das axilas.</p>
                </div>
                <div class="sg-guide-item">
                  <div class="sg-guide-label">Cintura</div>
                  <p>Medir a circunferência da cintura na parte mais estreita.</p>
                </div>
                <div class="sg-guide-item">
                  <div class="sg-guide-label">Anca</div>
                  <p>Medir a circunferência da anca na parte mais ampla, ao nível das nádegas.</p>
                </div>

                {%- when 'saia' or 'saia-calcao' -%}
                <div class="sg-guide-item">
                  <div class="sg-guide-label">Cintura</div>
                  <p>Medir a circunferência da cintura na parte mais estreita.</p>
                </div>
                <div class="sg-guide-item">
                  <div class="sg-guide-label">Anca</div>
                  <p>Medir a circunferência da anca na parte mais ampla, ao nível das nádegas.</p>
                </div>

                {%- when 'calcas' or 'calcoes' -%}
                <div class="sg-guide-item">
                  <div class="sg-guide-label">Cintura</div>
                  <p>Medir a circunferência da cintura onde as calças devem assentar.</p>
                </div>
                <div class="sg-guide-item">
                  <div class="sg-guide-label">Anca</div>
                  <p>Medir a circunferência da anca na parte mais ampla.</p>
                </div>

                  {%- else -%}
                  <p class="sg-empty">Adicione tags ao produto para ver o guia de medidas.</p>
                {%- endcase -%}
              {%- endif -%}
            </div>
          </div>
        </div>

      </aside>
    </div>
  </div>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

  /* ══════════════════════════════════════════════════════════
     ZARA-INSPIRED MINIMALIST DESIGN
     Clean, modern, black & white aesthetic
     ══════════════════════════════════════════════════════════ */

  .sg-root {
    --sg-black: #000000;
    --sg-white: #FFFFFF;
    --sg-grey-light: #F5F5F5;
    --sg-grey-border: #E5E5E5;
    --sg-grey-text: #707070;

    --sg-font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  }

  /* Root & Overlay */
  .sg-root {
    position: fixed;
    inset: 0;
    z-index: 2147483645;
    display: grid;
    isolation: isolate;
    font-family: var(--sg-font);
    color: var(--sg-black);
  }
  .sg-root[hidden] { display: none; }

  .sg-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    z-index: 0;
    animation: sg-fade 0.25s ease;
  }

  @keyframes sg-fade {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Panel */
  .sg-panel {
    position: fixed;
    top: 0;
    right: 0;
    height: 100%;
    width: min(520px, 100%);
    background: var(--sg-white);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    z-index: 1;
    animation: sg-slide 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  @keyframes sg-slide {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
  }

  .sg-panel::-webkit-scrollbar {
    width: 0;
  }

  /* Header */
  .sg-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 24px 32px;
    border-bottom: 1px solid var(--sg-grey-border);
  }

  .sg-title {
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 0.08em;
    margin: 0;
    color: var(--sg-black);
  }

  .sg-close {
    background: none;
    border: none;
    padding: 8px;
    cursor: pointer;
    color: var(--sg-black);
    transition: opacity 0.2s;
    margin: -8px -8px -8px 0;
  }

  .sg-close:hover {
    opacity: 0.6;
  }

  /* Tabs */
  .sg-tabs {
    display: flex;
    border-bottom: 1px solid var(--sg-grey-border);
    padding: 0;
    margin: 0;
  }

  .sg-tab {
    flex: 1;
    background: none;
    border: none;
    padding: 16px 24px;
    font-family: var(--sg-font);
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.08em;
    cursor: pointer;
    color: var(--sg-grey-text);
    position: relative;
    transition: color 0.2s;
    border-bottom: 2px solid transparent;
  }

  .sg-tab:hover {
    color: var(--sg-black);
  }

  .sg-tab--active {
    color: var(--sg-black);
    border-bottom-color: var(--sg-black);
  }

  /* Tab Panels */
  .sg-tab-panel {
    display: none;
    padding: 32px;
  }

  .sg-tab-panel--active {
    display: block;
  }

  /* Size Selector */
  .sg-size-selector {
    margin-bottom: 32px;
  }

  .sg-size-buttons {
    display: flex;
    gap: 8px;
  }

  .sg-size-btn,
  .sg-size-btn-body {
    flex: 1;
    padding: 12px;
    background: var(--sg-white);
    border: 1px solid var(--sg-black);
    font-family: var(--sg-font);
    font-size: 13px;
    font-weight: 500;
    color: var(--sg-black);
    cursor: pointer;
    transition: all 0.15s;
  }

  .sg-size-btn:hover,
  .sg-size-btn-body:hover {
    background: var(--sg-grey-light);
  }

  .sg-size-btn--active,
  .sg-size-btn-body--active {
    background: var(--sg-black);
    color: var(--sg-white);
  }

  /* Product Image */
  .sg-media {
    display: flex;
    justify-content: center;
    margin-bottom: 32px;
  }

  .sg-img {
    width: 100%;
    max-width: 280px;
    height: auto;
    display: block;
  }

  /* Table */
  .sg-table-container {
    margin-bottom: 24px;
  }

  .sg-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
  }

  .sg-table thead th {
    padding: 12px 8px;
    text-align: left;
    font-weight: 600;
    font-size: 10px;
    letter-spacing: 0.08em;
    color: var(--sg-grey-text);
    border-bottom: 1px solid var(--sg-grey-border);
  }

  .sg-table thead th:first-child {
    padding-left: 0;
  }

  .sg-table tbody td {
    padding: 12px 8px;
    text-align: left;
    border-bottom: 1px solid var(--sg-grey-border);
    transition: background 0.2s;
  }

  .sg-table tbody td:first-child {
    padding-left: 0;
  }

  .sg-table tbody tr:last-child td {
    border-bottom: none;
  }

  .sg-table-label {
    font-weight: 500;
  }

  .sg-table thead th.sg-highlight,
  .sg-table tbody td.sg-highlight {
    background: var(--sg-grey-light);
    font-weight: 600;
  }

  /* Note */
  .sg-note {
    font-size: 11px;
    line-height: 1.6;
    color: var(--sg-grey-text);
    margin: 0;
    padding: 16px 0 0;
    border-top: 1px solid var(--sg-grey-border);
  }

  /* Guide Section */
  .sg-guide-section {
    margin-top: 40px;
    padding-top: 32px;
    border-top: 1px solid var(--sg-grey-border);
  }

  .sg-guide-title {
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.08em;
    margin: 0 0 24px 0;
    color: var(--sg-black);
  }

  .sg-guide-content {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .sg-guide-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .sg-guide-label {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.05em;
    color: var(--sg-black);
  }

  .sg-guide-item p {
    font-size: 12px;
    line-height: 1.6;
    color: var(--sg-grey-text);
    margin: 0;
  }

  /* Empty State */
  .sg-empty {
    padding: 48px 24px;
    text-align: center;
    color: var(--sg-grey-text);
    font-size: 12px;
  }

  .sg-empty p {
    margin: 0;
  }

  /* Mobile */
  @media (max-width: 640px) {
    .sg-panel {
      width: 100%;
    }

    .sg-header {
      padding: 20px 24px;
    }

    .sg-title {
      font-size: 13px;
    }

    .sg-tab {
      padding: 14px 16px;
      font-size: 10px;
    }

    .sg-tab-panel {
      padding: 24px;
    }

    .sg-size-btn,
    .sg-size-btn-body {
      padding: 10px;
      font-size: 12px;
    }

    .sg-table {
      font-size: 11px;
    }

    .sg-table thead th,
    .sg-table tbody td {
      padding: 10px 6px;
    }
  }

  /* Focus States */
  .sg-close:focus-visible,
  .sg-tab:focus-visible,
  .sg-size-btn:focus-visible,
  .sg-size-btn-body:focus-visible {
    outline: 2px solid var(--sg-black);
    outline-offset: 2px;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const wrap = document.getElementById("sg-wrap-{{ sg_id }}");
  if(!wrap) return;

  let root = wrap.querySelector("#{{ sg_id }}");
  if(!root) return;

  const openTriggers = document.querySelectorAll('[data-sg-open="{{ sg_id }}"]');

  /* Portal */
  if(!root.hasAttribute('data-sg-portal')){
    document.body.appendChild(root);
    root.setAttribute('data-sg-portal','true');
  }

  const panel = root.querySelector('.sg-panel');
  const overlay = root.querySelector('.sg-overlay');
  const closeBtns = root.querySelectorAll('[data-sg-close]');
  const tabs = root.querySelectorAll('.sg-tab');
  const tabPanels = root.querySelectorAll('.sg-tab-panel');
  const sizeButtons = root.querySelectorAll('.sg-size-btn');
  const sizeButtonsBody = root.querySelectorAll('.sg-size-btn-body');

  /* Tab Navigation */
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const targetPanel = tab.dataset.tab;
      tabs.forEach(t => {
        t.classList.remove('sg-tab--active');
        t.setAttribute('aria-selected', 'false');
      });
      tab.classList.add('sg-tab--active');
      tab.setAttribute('aria-selected', 'true');
      tabPanels.forEach(p => p.classList.remove('sg-tab-panel--active'));
      const activePanel = root.querySelector(`[data-panel="${targetPanel}"]`);
      if(activePanel) activePanel.classList.add('sg-tab-panel--active');
    });
  });

  /* Size Selection */
  function updateHighlight(buttons, dataAttr) {
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        const selectedSize = btn.dataset[dataAttr];
        buttons.forEach(b => {
          b.classList.remove('sg-size-btn--active', 'sg-size-btn-body--active');
          b.setAttribute('aria-checked', 'false');
        });
        btn.classList.add(dataAttr === 'size' ? 'sg-size-btn--active' : 'sg-size-btn-body--active');
        btn.setAttribute('aria-checked', 'true');

        const cells = root.querySelectorAll(`[data-${dataAttr === 'size' ? 'size' : 'size-body'}]`);
        cells.forEach(cell => {
          if(cell.dataset[dataAttr === 'size' ? 'size' : 'sizeBody'] === selectedSize) {
            cell.classList.add('sg-highlight');
          } else {
            cell.classList.remove('sg-highlight');
          }
        });
      });
    });
  }

  updateHighlight(sizeButtons, 'size');
  updateHighlight(sizeButtonsBody, 'sizeBody');

  /* Focus Trap */
  function trapFocus(e){
    if(e.key !== 'Tab') return;
    const focusable = root.querySelectorAll('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])');
    const first = focusable[0], last = focusable[focusable.length - 1];
    if(e.shiftKey && document.activeElement === first){ last.focus(); e.preventDefault(); }
    else if(!e.shiftKey && document.activeElement === last){ first.focus(); e.preventDefault(); }
  }

  /* Open/Close */
  function openDrawer(e){
    if(e) e.preventDefault();
    root.hidden = false;
    document.documentElement.style.overflow = 'hidden';
    openTriggers.forEach(t => t.setAttribute('aria-expanded','true'));
    panel.focus();
    document.addEventListener('keydown', onKeydown);
    document.addEventListener('keydown', trapFocus);
  }

  function closeDrawer(){
    root.hidden = true;
    document.documentElement.style.overflow = '';
    openTriggers.forEach(t => t.setAttribute('aria-expanded','false'));
    document.removeEventListener('keydown', onKeydown);
    document.removeEventListener('keydown', trapFocus);
  }

  function onKeydown(e){
    if(e.key === 'Escape') closeDrawer();
  }

  openTriggers.forEach(trigger => {
    trigger.addEventListener('click', openDrawer);
  });
  overlay.addEventListener('click', closeDrawer);
  closeBtns.forEach(b=> b.addEventListener('click', closeDrawer));

  /* Initialize */
  if(sizeButtons.length > 0) sizeButtons[0].click();
  if(sizeButtonsBody.length > 0) sizeButtonsBody[0].click();
});
</script>

{%- endif -%}
