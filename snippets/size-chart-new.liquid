{%- comment -%}
  SNIPPET: size-chart-new.liquid
  Refined editorial-style size guide drawer with tab navigation
{%- endcomment -%}

{%- if product -%}
  {%- assign _scope_id = section.id | default: block.id | default: product.id -%}
  {%- assign sg_id = 'sg-' | append: product.id | append: '-' | append: _scope_id -%}

  {%- assign sizechart_key = '' -%}
  {%- for tag in product.tags -%}
    {%- assign tag_lower = tag | downcase | strip -%}
    {%- if tag_lower == 'camisola' or tag_lower == 'camisolas' or tag_lower == 't-shirt' or tag_lower == 't-shirts' or tag_lower == 'tshirt' or tag_lower == 'tshirts' or tag_lower == 'sweatshirt' or tag_lower == 'sweatshirts' or tag_lower == 'tops' or tag_lower == 'bodies' or tag_lower == 'blusa' or tag_lower == 'blusas' or tag_lower == 'camisa' or tag_lower == 'camisas' -%}
      {%- assign sizechart_key = 'tops' -%}
      {%- break -%}
    {%- elsif tag_lower == 'saia' or tag_lower == 'saias' -%}
      {%- assign sizechart_key = 'saia' -%}
      {%- break -%}
    {%- elsif tag_lower == 'saia-calção' or tag_lower == 'saias-calção' -%}
      {%- assign sizechart_key = 'saia-calcao' -%}
      {%- break -%}
    {%- elsif tag_lower == 'calcas' or tag_lower == 'calças' or tag_lower == 'jeans' or tag_lower == 'calças de ganga' -%}
      {%- assign sizechart_key = 'calcas' -%}
      {%- break -%}
    {%- elsif tag_lower == 'calção' or tag_lower == 'calções' -%}
      {%- assign sizechart_key = 'calcoes' -%}
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}

  <div id="sg-wrap-{{ sg_id }}" class="sg-wrap">
    <div class="sg-root" id="{{ sg_id }}" hidden role="dialog" aria-modal="true" aria-label="Guia de tamanhos">
      <div class="sg-overlay" data-sg-close></div>
      <aside class="sg-panel" tabindex="-1">

        <!-- Header -->
        <header class="sg-header">
          <h2 class="sg-title">Guia de tamanhos</h2>
          <button class="sg-close" type="button" data-sg-close aria-label="Fechar">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </button>
        </header>

        <!-- Tab Navigation -->
        <div class="sg-tabs" role="tablist">
          <button class="sg-tab sg-tab--active" role="tab" aria-selected="true" aria-controls="sg-panel-measurements-{{ sg_id }}" id="sg-tab-measurements-{{ sg_id }}" data-tab="measurements">
            Medidas Artigo
          </button>
          <button class="sg-tab" role="tab" aria-selected="false" aria-controls="sg-panel-body-{{ sg_id }}" id="sg-tab-body-{{ sg_id }}" data-tab="body">
            Medidas Corporais
          </button>
        </div>

        <!-- Tab Panel: Measurements -->
        <div class="sg-tab-panel sg-tab-panel--active" role="tabpanel" id="sg-panel-measurements-{{ sg_id }}" aria-labelledby="sg-tab-measurements-{{ sg_id }}" data-panel="measurements">

          <!-- Size Selector -->
          {%- case sizechart_key -%}
            {%- when 'tops' or 'saia' or 'saia-calcao' or 'calcas' or 'calcoes' -%}
              <div class="sg-size-selector">
                <p class="sg-size-label">Selecione o tamanho</p>
                <div class="sg-size-buttons" role="radiogroup">
                  <button class="sg-size-btn sg-size-btn--active" role="radio" aria-checked="true" data-size="S">S</button>
                  <button class="sg-size-btn" role="radio" aria-checked="false" data-size="M">M</button>
                  <button class="sg-size-btn" role="radio" aria-checked="false" data-size="L">L</button>
                  <button class="sg-size-btn" role="radio" aria-checked="false" data-size="XL">XL</button>
                  <button class="sg-size-btn" role="radio" aria-checked="false" data-size="XXL">XXL</button>
                </div>
              </div>
          {%- endcase -%}

          <!-- Product Image -->
          <div class="sg-media">
            {%- assign first_media = product.featured_media | default: product.media.first -%}
            {%- if first_media -%}
              <img class="sg-img"
                   alt="{{ first_media.alt | default: product.title | escape }}"
                   loading="lazy"
                   src="{{ first_media | image_url: width: 600 }}"
                   srcset="{{ first_media | image_url: width: 400 }} 400w, {{ first_media | image_url: width: 600 }} 600w"
                   sizes="(max-width: 740px) 200px, 300px">
            {%- endif -%}
          </div>

          <!-- Measurement Table -->
          <div class="sg-table-container">
            {%- case sizechart_key -%}

              {%- when 'tops' -%}
              <div class="sg-measurement-grid">
                <div class="sg-measurement-row sg-measurement-row--header">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Medida</div>
                  <div class="sg-measurement-cell" data-size="S">S</div>
                  <div class="sg-measurement-cell" data-size="M">M</div>
                  <div class="sg-measurement-cell" data-size="L">L</div>
                  <div class="sg-measurement-cell" data-size="XL">XL</div>
                  <div class="sg-measurement-cell" data-size="XXL">XXL</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Peito</div>
                  <div class="sg-measurement-cell" data-size="S">50 cm</div>
                  <div class="sg-measurement-cell" data-size="M">53 cm</div>
                  <div class="sg-measurement-cell" data-size="L">56 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">59 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">62 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Comprimento</div>
                  <div class="sg-measurement-cell" data-size="S">70 cm</div>
                  <div class="sg-measurement-cell" data-size="M">72 cm</div>
                  <div class="sg-measurement-cell" data-size="L">74 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">76 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">78 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Manga</div>
                  <div class="sg-measurement-cell" data-size="S">20 cm</div>
                  <div class="sg-measurement-cell" data-size="M">21 cm</div>
                  <div class="sg-measurement-cell" data-size="L">22 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">23 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">24 cm</div>
                </div>
              </div>

              {%- when 'saia' -%}
              <div class="sg-measurement-grid">
                <div class="sg-measurement-row sg-measurement-row--header">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Medida</div>
                  <div class="sg-measurement-cell" data-size="S">S</div>
                  <div class="sg-measurement-cell" data-size="M">M</div>
                  <div class="sg-measurement-cell" data-size="L">L</div>
                  <div class="sg-measurement-cell" data-size="XL">XL</div>
                  <div class="sg-measurement-cell" data-size="XXL">XXL</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Cintura</div>
                  <div class="sg-measurement-cell" data-size="S">68 cm</div>
                  <div class="sg-measurement-cell" data-size="M">72 cm</div>
                  <div class="sg-measurement-cell" data-size="L">76 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">80 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">84 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Anca</div>
                  <div class="sg-measurement-cell" data-size="S">88 cm</div>
                  <div class="sg-measurement-cell" data-size="M">92 cm</div>
                  <div class="sg-measurement-cell" data-size="L">96 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">100 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">104 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Comprimento</div>
                  <div class="sg-measurement-cell" data-size="S">40 cm</div>
                  <div class="sg-measurement-cell" data-size="M">41 cm</div>
                  <div class="sg-measurement-cell" data-size="L">42 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">43 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">44 cm</div>
                </div>
              </div>

              {%- when 'saia-calcao' -%}
              <div class="sg-measurement-grid">
                <div class="sg-measurement-row sg-measurement-row--header">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Medida</div>
                  <div class="sg-measurement-cell" data-size="S">S</div>
                  <div class="sg-measurement-cell" data-size="M">M</div>
                  <div class="sg-measurement-cell" data-size="L">L</div>
                  <div class="sg-measurement-cell" data-size="XL">XL</div>
                  <div class="sg-measurement-cell" data-size="XXL">XXL</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Cintura</div>
                  <div class="sg-measurement-cell" data-size="S">68 cm</div>
                  <div class="sg-measurement-cell" data-size="M">72 cm</div>
                  <div class="sg-measurement-cell" data-size="L">76 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">80 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">84 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Anca</div>
                  <div class="sg-measurement-cell" data-size="S">88 cm</div>
                  <div class="sg-measurement-cell" data-size="M">92 cm</div>
                  <div class="sg-measurement-cell" data-size="L">96 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">100 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">104 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Comprimento</div>
                  <div class="sg-measurement-cell" data-size="S">36 cm</div>
                  <div class="sg-measurement-cell" data-size="M">37 cm</div>
                  <div class="sg-measurement-cell" data-size="L">38 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">39 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">40 cm</div>
                </div>
              </div>

              {%- when 'calcas' -%}
              <div class="sg-measurement-grid">
                <div class="sg-measurement-row sg-measurement-row--header">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Medida</div>
                  <div class="sg-measurement-cell" data-size="S">S</div>
                  <div class="sg-measurement-cell" data-size="M">M</div>
                  <div class="sg-measurement-cell" data-size="L">L</div>
                  <div class="sg-measurement-cell" data-size="XL">XL</div>
                  <div class="sg-measurement-cell" data-size="XXL">XXL</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Cintura</div>
                  <div class="sg-measurement-cell" data-size="S">72 cm</div>
                  <div class="sg-measurement-cell" data-size="M">76 cm</div>
                  <div class="sg-measurement-cell" data-size="L">80 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">84 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">88 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Anca</div>
                  <div class="sg-measurement-cell" data-size="S">92 cm</div>
                  <div class="sg-measurement-cell" data-size="M">96 cm</div>
                  <div class="sg-measurement-cell" data-size="L">100 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">104 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">108 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Comprimento</div>
                  <div class="sg-measurement-cell" data-size="S">100 cm</div>
                  <div class="sg-measurement-cell" data-size="M">102 cm</div>
                  <div class="sg-measurement-cell" data-size="L">104 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">106 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">108 cm</div>
                </div>
              </div>

              {%- when 'calcoes' -%}
              <div class="sg-measurement-grid">
                <div class="sg-measurement-row sg-measurement-row--header">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Medida</div>
                  <div class="sg-measurement-cell" data-size="S">S</div>
                  <div class="sg-measurement-cell" data-size="M">M</div>
                  <div class="sg-measurement-cell" data-size="L">L</div>
                  <div class="sg-measurement-cell" data-size="XL">XL</div>
                  <div class="sg-measurement-cell" data-size="XXL">XXL</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Cintura</div>
                  <div class="sg-measurement-cell" data-size="S">72 cm</div>
                  <div class="sg-measurement-cell" data-size="M">76 cm</div>
                  <div class="sg-measurement-cell" data-size="L">80 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">84 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">88 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Anca</div>
                  <div class="sg-measurement-cell" data-size="S">92 cm</div>
                  <div class="sg-measurement-cell" data-size="M">96 cm</div>
                  <div class="sg-measurement-cell" data-size="L">100 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">104 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">108 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Comprimento</div>
                  <div class="sg-measurement-cell" data-size="S">42 cm</div>
                  <div class="sg-measurement-cell" data-size="M">44 cm</div>
                  <div class="sg-measurement-cell" data-size="L">46 cm</div>
                  <div class="sg-measurement-cell" data-size="XL">48 cm</div>
                  <div class="sg-measurement-cell" data-size="XXL">50 cm</div>
                </div>
              </div>

              {%- else -%}
              <div class="sg-empty">
                <p>Sem tabela específica para este produto.</p>
                <p class="sg-empty-hint">Adicione uma tag como: tops, saia, saia-calção, calcas, ou calções.</p>
              </div>
            {%- endcase -%}
          </div>

          <!-- Note -->
          <p class="sg-note">As medidas podem apresentar pequenas variações devido ao processo de produção. A peça está medida esticada.</p>
        </div>

        <!-- Tab Panel: Body Measurements -->
        <div class="sg-tab-panel" role="tabpanel" id="sg-panel-body-{{ sg_id }}" aria-labelledby="sg-tab-body-{{ sg_id }}" data-panel="body">
          <h3 class="sg-guide-title">Selecione o tamanho</h3>

          <!-- Size Selector for Body -->
          {%- case sizechart_key -%}
            {%- when 'tops' or 'saia' or 'saia-calcao' or 'calcas' or 'calcoes' -%}
              <div class="sg-size-selector">
                <div class="sg-size-buttons" role="radiogroup">
                  <button class="sg-size-btn-body sg-size-btn-body--active" role="radio" aria-checked="true" data-size-body="S">S</button>
                  <button class="sg-size-btn-body" role="radio" aria-checked="false" data-size-body="M">M</button>
                  <button class="sg-size-btn-body" role="radio" aria-checked="false" data-size-body="L">L</button>
                  <button class="sg-size-btn-body" role="radio" aria-checked="false" data-size-body="XL">XL</button>
                  <button class="sg-size-btn-body" role="radio" aria-checked="false" data-size-body="XXL">XXL</button>
                </div>
              </div>
          {%- endcase -%}

          <!-- Body Measurement Table -->
          <div class="sg-table-container">
            {%- case sizechart_key -%}

              {%- when 'tops' -%}
              <div class="sg-measurement-grid">
                <div class="sg-measurement-row sg-measurement-row--header">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Medida</div>
                  <div class="sg-measurement-cell" data-size-body="S">S</div>
                  <div class="sg-measurement-cell" data-size-body="M">M</div>
                  <div class="sg-measurement-cell" data-size-body="L">L</div>
                  <div class="sg-measurement-cell" data-size-body="XL">XL</div>
                  <div class="sg-measurement-cell" data-size-body="XXL">XXL</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Peito</div>
                  <div class="sg-measurement-cell" data-size-body="S">82-86 cm</div>
                  <div class="sg-measurement-cell" data-size-body="M">87-91 cm</div>
                  <div class="sg-measurement-cell" data-size-body="L">92-96 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XL">97-101 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XXL">102-106 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Cintura</div>
                  <div class="sg-measurement-cell" data-size-body="S">62-66 cm</div>
                  <div class="sg-measurement-cell" data-size-body="M">67-71 cm</div>
                  <div class="sg-measurement-cell" data-size-body="L">72-76 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XL">77-81 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XXL">82-86 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Anca</div>
                  <div class="sg-measurement-cell" data-size-body="S">88-92 cm</div>
                  <div class="sg-measurement-cell" data-size-body="M">93-97 cm</div>
                  <div class="sg-measurement-cell" data-size-body="L">98-102 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XL">103-107 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XXL">108-112 cm</div>
                </div>
              </div>

              {%- when 'saia' or 'saia-calcao' -%}
              <div class="sg-measurement-grid">
                <div class="sg-measurement-row sg-measurement-row--header">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Medida</div>
                  <div class="sg-measurement-cell" data-size-body="S">S</div>
                  <div class="sg-measurement-cell" data-size-body="M">M</div>
                  <div class="sg-measurement-cell" data-size-body="L">L</div>
                  <div class="sg-measurement-cell" data-size-body="XL">XL</div>
                  <div class="sg-measurement-cell" data-size-body="XXL">XXL</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Cintura</div>
                  <div class="sg-measurement-cell" data-size-body="S">62-66 cm</div>
                  <div class="sg-measurement-cell" data-size-body="M">67-71 cm</div>
                  <div class="sg-measurement-cell" data-size-body="L">72-76 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XL">77-81 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XXL">82-86 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Anca</div>
                  <div class="sg-measurement-cell" data-size-body="S">88-92 cm</div>
                  <div class="sg-measurement-cell" data-size-body="M">93-97 cm</div>
                  <div class="sg-measurement-cell" data-size-body="L">98-102 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XL">103-107 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XXL">108-112 cm</div>
                </div>
              </div>

              {%- when 'calcas' or 'calcoes' -%}
              <div class="sg-measurement-grid">
                <div class="sg-measurement-row sg-measurement-row--header">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Medida</div>
                  <div class="sg-measurement-cell" data-size-body="S">S</div>
                  <div class="sg-measurement-cell" data-size-body="M">M</div>
                  <div class="sg-measurement-cell" data-size-body="L">L</div>
                  <div class="sg-measurement-cell" data-size-body="XL">XL</div>
                  <div class="sg-measurement-cell" data-size-body="XXL">XXL</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Cintura</div>
                  <div class="sg-measurement-cell" data-size-body="S">68-72 cm</div>
                  <div class="sg-measurement-cell" data-size-body="M">73-77 cm</div>
                  <div class="sg-measurement-cell" data-size-body="L">78-82 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XL">83-87 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XXL">88-92 cm</div>
                </div>
                <div class="sg-measurement-row">
                  <div class="sg-measurement-cell sg-measurement-cell--label">Anca</div>
                  <div class="sg-measurement-cell" data-size-body="S">88-92 cm</div>
                  <div class="sg-measurement-cell" data-size-body="M">93-97 cm</div>
                  <div class="sg-measurement-cell" data-size-body="L">98-102 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XL">103-107 cm</div>
                  <div class="sg-measurement-cell" data-size-body="XXL">108-112 cm</div>
                </div>
              </div>

              {%- else -%}
              <div class="sg-empty">
                <p>Sem tabela específica para este produto.</p>
                <p class="sg-empty-hint">Adicione uma tag como: tops, saia, saia-calção, calcas, ou calções.</p>
              </div>
            {%- endcase -%}
          </div>

          <!-- How to Measure Guide -->
          <h4 class="sg-guide-subtitle">Como medir corretamente</h4>
          <div class="sg-guide-content">
            {%- case sizechart_key -%}
              {%- when 'tops' -%}
              <div class="sg-guide-item">
                <div class="sg-guide-number">1</div>
                <div class="sg-guide-text">
                  <h4>Peito</h4>
                  <p>Medir a circunferência do peito na parte mais ampla, abaixo das axilas.</p>
                </div>
              </div>
              <div class="sg-guide-item">
                <div class="sg-guide-number">2</div>
                <div class="sg-guide-text">
                  <h4>Cintura</h4>
                  <p>Medir a circunferência da cintura na parte mais estreita.</p>
                </div>
              </div>
              <div class="sg-guide-item">
                <div class="sg-guide-number">3</div>
                <div class="sg-guide-text">
                  <h4>Anca</h4>
                  <p>Medir a circunferência da anca na parte mais ampla, ao nível das nádegas.</p>
                </div>
              </div>

              {%- when 'saia' or 'saia-calcao' -%}
              <div class="sg-guide-item">
                <div class="sg-guide-number">1</div>
                <div class="sg-guide-text">
                  <h4>Cintura</h4>
                  <p>Medir a circunferência da cintura na parte mais estreita.</p>
                </div>
              </div>
              <div class="sg-guide-item">
                <div class="sg-guide-number">2</div>
                <div class="sg-guide-text">
                  <h4>Anca</h4>
                  <p>Medir a circunferência da anca na parte mais ampla, ao nível das nádegas.</p>
                </div>
              </div>

              {%- when 'calcas' or 'calcoes' -%}
              <div class="sg-guide-item">
                <div class="sg-guide-number">1</div>
                <div class="sg-guide-text">
                  <h4>Cintura</h4>
                  <p>Medir a circunferência da cintura onde as calças devem assentar.</p>
                </div>
              </div>
              <div class="sg-guide-item">
                <div class="sg-guide-number">2</div>
                <div class="sg-guide-text">
                  <h4>Anca</h4>
                  <p>Medir a circunferência da anca na parte mais ampla.</p>
                </div>
              </div>

              {%- else -%}
              <p class="sg-empty">Adicione tags ao produto para ver o guia de medidas.</p>
            {%- endcase -%}
          </div>
        </div>

      </aside>
    </div>
  </div>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=DM+Sans:wght@400;500;600&display=swap');

  /* Root Variables */
  .sg-root {
    --sg-black: #1a1a1a;
    --sg-grey: #666;
    --sg-light-grey: #f5f5f5;
    --sg-border: #e8e4df;
    --sg-accent: #e8e4df;
    --sg-white: #ffffff;

    --sg-font-serif: 'Cormorant Garamond', serif;
    --sg-font-sans: 'DM Sans', sans-serif;

    --sg-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Root Container */
  .sg-root {
    position: fixed;
    inset: 0;
    z-index: 2147483645;
    display: grid;
    isolation: isolate;
    font-family: var(--sg-font-sans);
    color: var(--sg-black);
  }
  .sg-root[hidden] { display: none; }

  /* Overlay */
  .sg-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    z-index: 0;
    animation: sg-fade-in 0.3s ease;
  }

  @keyframes sg-fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Panel */
  .sg-panel {
    position: fixed;
    top: 0;
    right: 0;
    height: 100%;
    width: min(540px, 100%);
    background: var(--sg-white);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    z-index: 1;
    animation: sg-slide-in 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: -8px 0 40px rgba(0, 0, 0, 0.12);
  }

  @keyframes sg-slide-in {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  /* Header */
  .sg-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 32px 32px 24px;
    border-bottom: 1px solid var(--sg-border);
  }

  .sg-title {
    font-family: var(--sg-font-serif);
    font-size: 28px;
    font-weight: 600;
    margin: 0;
    letter-spacing: -0.02em;
    color: var(--sg-black);
  }

  .sg-close {
    background: transparent;
    border: none;
    padding: 8px;
    cursor: pointer;
    color: var(--sg-grey);
    transition: var(--sg-transition);
    border-radius: 4px;
  }

  .sg-close:hover {
    color: var(--sg-black);
    background: var(--sg-light-grey);
  }

  /* Tabs */
  .sg-tabs {
    display: flex;
    gap: 0;
    padding: 0 32px;
    margin-top: 24px;
    border-bottom: 1px solid var(--sg-border);
  }

  .sg-tab {
    flex: 1;
    background: transparent;
    border: none;
    padding: 16px 24px;
    font-family: var(--sg-font-sans);
    font-size: 13px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    cursor: pointer;
    color: var(--sg-grey);
    position: relative;
    transition: var(--sg-transition);
  }

  .sg-tab::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--sg-black);
    transform: scaleX(0);
    transition: transform 0.3s ease;
  }

  .sg-tab--active {
    color: var(--sg-black);
  }

  .sg-tab--active::after {
    transform: scaleX(1);
  }

  .sg-tab:hover:not(.sg-tab--active) {
    color: var(--sg-black);
  }

  /* Tab Panels */
  .sg-tab-panel {
    display: none;
    padding: 32px;
    animation: sg-tab-fade-in 0.4s ease;
  }

  .sg-tab-panel--active {
    display: block;
  }

  @keyframes sg-tab-fade-in {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Size Selector */
  .sg-size-selector {
    margin-bottom: 32px;
  }

  .sg-size-label {
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--sg-grey);
    margin-bottom: 12px;
  }

  .sg-size-buttons {
    display: flex;
    gap: 8px;
  }

  .sg-size-btn {
    flex: 1;
    padding: 14px;
    background: var(--sg-white);
    border: 1.5px solid var(--sg-border);
    font-family: var(--sg-font-sans);
    font-size: 14px;
    font-weight: 500;
    color: var(--sg-black);
    cursor: pointer;
    transition: var(--sg-transition);
    border-radius: 2px;
  }

  .sg-size-btn:hover {
    border-color: var(--sg-black);
    background: var(--sg-light-grey);
  }

  .sg-size-btn--active {
    background: var(--sg-black);
    color: var(--sg-white);
    border-color: var(--sg-black);
  }

  /* Body Size Buttons */
  .sg-size-btn-body {
    flex: 1;
    padding: 14px;
    background: var(--sg-white);
    border: 1.5px solid var(--sg-border);
    font-family: var(--sg-font-sans);
    font-size: 14px;
    font-weight: 500;
    color: var(--sg-black);
    cursor: pointer;
    transition: var(--sg-transition);
    border-radius: 2px;
  }

  .sg-size-btn-body:hover {
    border-color: var(--sg-black);
    background: var(--sg-light-grey);
  }

  .sg-size-btn-body--active {
    background: var(--sg-black);
    color: var(--sg-white);
    border-color: var(--sg-black);
  }

  /* Product Image */
  .sg-media {
    display: flex;
    justify-content: center;
    margin-bottom: 32px;
  }

  .sg-img {
    width: 100%;
    max-width: 280px;
    height: auto;
    border-radius: 2px;
    object-fit: cover;
  }

  /* Measurement Grid */
  .sg-table-container {
    margin-bottom: 24px;
  }

  .sg-measurement-grid {
    display: flex;
    flex-direction: column;
    gap: 1px;
    background: var(--sg-border);
    border: 1px solid var(--sg-border);
    border-radius: 2px;
    overflow: hidden;
  }

  .sg-measurement-row {
    display: grid;
    grid-template-columns: 120px repeat(5, 1fr);
    background: var(--sg-white);
  }

  .sg-measurement-row--header {
    background: var(--sg-light-grey);
  }

  .sg-measurement-cell {
    padding: 14px 12px;
    font-size: 13px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--sg-transition);
  }

  .sg-measurement-row--header .sg-measurement-cell {
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 11px;
    color: var(--sg-grey);
  }

  .sg-measurement-cell--label {
    text-align: left;
    justify-content: flex-start;
    font-weight: 500;
    background: var(--sg-light-grey);
    color: var(--sg-black);
  }

  /* Highlight selected size column */
  .sg-measurement-row:not(.sg-measurement-row--header) .sg-measurement-cell[data-size].sg-size-highlight,
  .sg-measurement-row:not(.sg-measurement-row--header) .sg-measurement-cell[data-size-body].sg-size-highlight {
    background: var(--sg-accent);
    font-weight: 600;
  }

  /* Note */
  .sg-note {
    font-size: 12px;
    line-height: 1.6;
    color: var(--sg-grey);
    margin: 0;
    padding: 16px;
    background: var(--sg-light-grey);
    border-radius: 2px;
    border-left: 3px solid var(--sg-accent);
  }

  /* Guide Content */
  .sg-guide-title {
    font-family: var(--sg-font-serif);
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 28px;
    color: var(--sg-black);
  }

  .sg-guide-subtitle {
    font-family: var(--sg-font-sans);
    font-size: 16px;
    font-weight: 600;
    margin: 32px 0 20px 0;
    color: var(--sg-black);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .sg-guide-content {
    display: flex;
    flex-direction: column;
    gap: 24px;
    margin-bottom: 32px;
  }

  .sg-guide-item {
    display: flex;
    gap: 16px;
    align-items: flex-start;
  }

  .sg-guide-number {
    flex-shrink: 0;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--sg-black);
    color: var(--sg-white);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--sg-font-serif);
    font-size: 16px;
    font-weight: 600;
  }

  .sg-guide-text h4 {
    font-size: 15px;
    font-weight: 600;
    margin: 0 0 6px 0;
    color: var(--sg-black);
  }

  .sg-guide-text p {
    font-size: 14px;
    line-height: 1.6;
    color: var(--sg-grey);
    margin: 0;
  }

  .sg-guide-tips {
    padding: 20px;
    background: var(--sg-light-grey);
    border-radius: 2px;
    margin-top: 24px;
  }

  .sg-guide-tips p {
    font-size: 13px;
    font-weight: 600;
    margin: 0 0 12px 0;
    color: var(--sg-black);
  }

  .sg-guide-tips ul {
    margin: 0;
    padding-left: 20px;
  }

  .sg-guide-tips li {
    font-size: 13px;
    line-height: 1.8;
    color: var(--sg-grey);
  }

  /* Empty State */
  .sg-empty {
    padding: 48px 24px;
    text-align: center;
    color: var(--sg-grey);
  }

  .sg-empty p {
    margin: 0 0 8px 0;
    font-size: 14px;
  }

  .sg-empty-hint {
    font-size: 12px;
    color: var(--sg-grey);
  }

  /* Mobile Responsive */
  @media (max-width: 640px) {
    .sg-panel {
      width: 100%;
    }

    .sg-header {
      padding: 24px 20px 20px;
    }

    .sg-title {
      font-size: 24px;
    }

    .sg-tabs {
      padding: 0 20px;
    }

    .sg-tab {
      font-size: 11px;
      padding: 14px 16px;
    }

    .sg-tab-panel {
      padding: 24px 20px;
    }

    .sg-measurement-row {
      grid-template-columns: 100px repeat(5, 1fr);
      font-size: 12px;
    }

    .sg-measurement-cell {
      padding: 10px 6px;
      font-size: 11px;
    }

    .sg-size-btn {
      padding: 12px;
      font-size: 13px;
    }
  }

  /* Desktop */
  @media (min-width: 1024px) {
    .sg-panel {
      width: min(640px, 100%);
    }
  }
</style>

<script>
(function(){
  const wrap = document.getElementById("sg-wrap-{{ sg_id }}");
  if(!wrap) return;

  let root = wrap.querySelector("#{{ sg_id }}");
  if(!root) return;

  const openTriggers = document.querySelectorAll('[data-sg-open="{{ sg_id }}"]');

  /* Portal: move drawer to body */
  if(!root.hasAttribute('data-sg-portal')){
    document.body.appendChild(root);
    root.setAttribute('data-sg-portal','true');
  }

  const panel = root.querySelector('.sg-panel');
  const overlay = root.querySelector('.sg-overlay');
  const closeBtns = root.querySelectorAll('[data-sg-close]');
  const tabs = root.querySelectorAll('.sg-tab');
  const tabPanels = root.querySelectorAll('.sg-tab-panel');
  const sizeButtons = root.querySelectorAll('.sg-size-btn');
  const sizeButtonsBody = root.querySelectorAll('.sg-size-btn-body');

  /* Tab Navigation */
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const targetPanel = tab.dataset.tab;

      // Update tabs
      tabs.forEach(t => {
        t.classList.remove('sg-tab--active');
        t.setAttribute('aria-selected', 'false');
      });
      tab.classList.add('sg-tab--active');
      tab.setAttribute('aria-selected', 'true');

      // Update panels
      tabPanels.forEach(p => {
        p.classList.remove('sg-tab-panel--active');
      });
      const activePanel = root.querySelector(`[data-panel="${targetPanel}"]`);
      if(activePanel) activePanel.classList.add('sg-tab-panel--active');
    });
  });

  /* Size Selection */
  sizeButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const selectedSize = btn.dataset.size;

      // Update button states
      sizeButtons.forEach(b => {
        b.classList.remove('sg-size-btn--active');
        b.setAttribute('aria-checked', 'false');
      });
      btn.classList.add('sg-size-btn--active');
      btn.setAttribute('aria-checked', 'true');

      // Highlight corresponding columns
      const allCells = root.querySelectorAll('.sg-measurement-cell[data-size]');
      allCells.forEach(cell => {
        if(cell.dataset.size === selectedSize) {
          cell.classList.add('sg-size-highlight');
        } else {
          cell.classList.remove('sg-size-highlight');
        }
      });
    });
  });

  /* Body Measurements Size Selection */
  sizeButtonsBody.forEach(btn => {
    btn.addEventListener('click', () => {
      const selectedSize = btn.dataset.sizeBody;

      // Update button states
      sizeButtonsBody.forEach(b => {
        b.classList.remove('sg-size-btn-body--active');
        b.setAttribute('aria-checked', 'false');
      });
      btn.classList.add('sg-size-btn-body--active');
      btn.setAttribute('aria-checked', 'true');

      // Highlight corresponding columns
      const allCells = root.querySelectorAll('.sg-measurement-cell[data-size-body]');
      allCells.forEach(cell => {
        if(cell.dataset.sizeBody === selectedSize) {
          cell.classList.add('sg-size-highlight');
        } else {
          cell.classList.remove('sg-size-highlight');
        }
      });
    });
  });

  /* Focus Trap */
  function trapFocus(e){
    if(e.key !== 'Tab') return;
    const focusable = root.querySelectorAll('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])');
    const first = focusable[0], last = focusable[focusable.length - 1];
    if(e.shiftKey && document.activeElement === first){ last.focus(); e.preventDefault(); }
    else if(!e.shiftKey && document.activeElement === last){ first.focus(); e.preventDefault(); }
  }

  /* Open/Close */
  function openDrawer(e, trigger){
    if(e) e.preventDefault();
    root.hidden = false;
    document.documentElement.style.overflow = 'hidden';
    openTriggers.forEach(t => t.setAttribute('aria-expanded','true'));
    panel.focus();
    document.addEventListener('keydown', onKeydown);
    document.addEventListener('keydown', trapFocus);
  }

  function closeDrawer(){
    root.hidden = true;
    document.documentElement.style.overflow = '';
    openTriggers.forEach(t => t.setAttribute('aria-expanded','false'));
    document.removeEventListener('keydown', onKeydown);
    document.removeEventListener('keydown', trapFocus);
  }

  function onKeydown(e){
    if(e.key === 'Escape') closeDrawer();
  }

  /* Attach handlers */
  openTriggers.forEach(trigger => {
    trigger.addEventListener('click', (e) => openDrawer(e, trigger));
  });
  overlay.addEventListener('click', closeDrawer);
  closeBtns.forEach(b=> b.addEventListener('click', closeDrawer));

  /* Initialize: highlight first size */
  if(sizeButtons.length > 0) {
    sizeButtons[0].click();
  }
  if(sizeButtonsBody.length > 0) {
    sizeButtonsBody[0].click();
  }
})();
</script>

{%- endif -%}
