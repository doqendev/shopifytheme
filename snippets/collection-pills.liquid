{% comment %}
  collection-pills.liquid
  Product-type filter pills for collection pages.

  Product type pills:
    - Always visible (from metafield or fallback to filter values)
    - Toggleable on/off
    - Clean, minimal design

  Other filters (color, size, etc.):
    - Managed through FILTROS drawer
    - Count displayed on FILTROS button
    - Not shown as chips in this bar
{% endcomment %}

{%- liquid
  assign product_type_filter = collection.filters | where: 'param_name', 'filter.p.product_type' | first

  assign raw_pills = nil
  if collection.metafields.custom.quick_filter_pills and collection.metafields.custom.quick_filter_pills.value != blank
    assign raw_pills = collection.metafields.custom.quick_filter_pills.value
  endif

  if raw_pills == nil or raw_pills == empty
    if product_type_filter
      assign raw_pills = product_type_filter.values | map: 'label'
    endif
  endif

  assign pill_joined = ''
  if raw_pills
    for pill in raw_pills
      assign base_label = pill.label | default: pill | strip
      assign base_value = pill.value | default: base_label | strip
      assign parts = base_value | split: ','
      for part in parts
        assign val = part | strip
        if val == ''
          continue
        endif
        if pill_joined == ''
          assign pill_joined = val
        else
          assign pill_joined = pill_joined | append: '||' | append: val
        endif
      endfor
    endfor
  endif

  assign show_pills = false
  if pill_joined != ''
    assign show_pills = true
  endif
  assign pill_items = pill_joined | split: '||'
-%}

<style>
  /* Hide ALL native active filter displays - only show count on FILTROS button */
  .active-facets,
  .active-facets-desktop,
  .active-facets-mobile,
  .active-facets-vertical-filter {
    display: none !important;
  }
</style>

{% if show_pills %}
  <style>
    /* Product type pills container */
    .collection-pills-wrapper {
      margin-top: 1.5rem;
      margin-bottom: 1.75rem;
    }

    /* Pills layout - DESKTOP */
    .collection-pills {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      flex-wrap: wrap;
      padding-left: 25px;
      padding-right: 25px;
    }

    /* Product type pills - DESKTOP (bigger) */
    .collection-pills__pill {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 1.125rem 2rem;
      border-radius: 999px;
      border: 1px solid rgba(var(--color-foreground), 0.12);
      background: rgb(var(--color-background));
      color: rgb(var(--color-foreground));
      font-size: 1.25rem;
      font-weight: 500;
      letter-spacing: 0.01em;
      text-decoration: none;
      white-space: nowrap;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .collection-pills__pill:hover {
      border-color: rgba(var(--color-foreground), 0.3);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    .collection-pills__pill.is-active {
      background: rgb(var(--color-foreground));
      color: rgb(var(--color-background));
      border-color: rgb(var(--color-foreground));
    }
    .collection-pills__pill.is-active:hover {
      opacity: 0.9;
    }

    /* MOBILE - Horizontal slider */
    @media (max-width: 749px) {
      .collection-pills-wrapper {
        margin-top: 1.25rem;
        margin-bottom: 1.5rem;
      }
      .collection-pills {
        gap: 0.625rem;
        padding-left: 20px;
        padding-right: 20px;
        flex-wrap: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scroll-snap-type: x mandatory;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE/Edge */
      }
      .collection-pills::-webkit-scrollbar {
        display: none; /* Chrome/Safari/Opera */
      }
      .collection-pills__pill {
        padding: 0.625rem 1rem;
        font-size: 0.875rem;
        scroll-snap-align: start;
        flex-shrink: 0;
      }
    }
  </style>

  <div class="collection-pills-wrapper page-width">
    <div class="collection-pills" role="list">
      {%- for pill_value in pill_items limit: 12 -%}
        {%- assign pill_label = pill_value -%}
        {%- assign href = collection.url | append: '?filter.p.product_type=' | append: pill_value | url_encode -%}
        {%- assign active = false -%}

        {%- if product_type_filter and product_type_filter.values -%}
          {%- assign match = nil -%}
          {%- for option in product_type_filter.values -%}
            {%- assign option_label_down = option.label | downcase -%}
            {%- assign option_value_down = option.value | downcase -%}
            {%- assign target_down = pill_value | downcase -%}
            {%- if option_label_down == target_down or option_value_down == target_down -%}
              {%- assign match = option -%}
              {%- break -%}
            {%- endif -%}
          {%- endfor -%}

          {%- if match -%}
            {%- assign href = match.url_to_add -%}
            {%- assign active = match.active -%}
            {%- if active -%}
              {%- assign href = match.url_to_remove -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}

        <a
          class="collection-pills__pill{% if active %} is-active{% endif %}"
          href="{{ href }}"
          role="listitem"
          aria-pressed="{{ active | default: false }}"
        >
          {{ pill_label | escape }}
        </a>
      {%- endfor -%}
    </div>
  </div>
{% endif %}
