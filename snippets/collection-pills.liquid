{% comment %}
  collection-pills.liquid
  Quick product-type pills for collection pages.

  Data source:
    - Preferred: collection.metafields.custom.quick_filter_pills (list)
      * Accepts list of strings or list items with a `label`/`value` property.
    - Fallback: first available product type filter values (if metafield empty).
{% endcomment %}

{%- liquid
  assign product_type_filter = collection.filters | where: 'param_name', 'filter.p.product_type' | first

  assign raw_pills = nil
  if collection.metafields.custom.quick_filter_pills and collection.metafields.custom.quick_filter_pills.value != blank
    assign raw_pills = collection.metafields.custom.quick_filter_pills.value
  endif

  if raw_pills == nil or raw_pills == empty
    if product_type_filter
      assign raw_pills = product_type_filter.values | map: 'label'
    endif
  endif

  assign pill_joined = ''
  if raw_pills
    for pill in raw_pills
      assign base_label = pill.label | default: pill | strip
      assign base_value = pill.value | default: base_label | strip
      assign parts = base_value | split: ','
      for part in parts
        assign val = part | strip
        if val == ''
          continue
        endif
        if pill_joined == ''
          assign pill_joined = val
        else
          assign pill_joined = pill_joined | append: '||' | append: val
        endif
      endfor
    endfor
  endif

  assign show_pills = false
  if pill_joined != ''
    assign show_pills = true
  endif
  assign pill_items = pill_joined | split: '||'
-%}

{% if show_pills %}
  <style>
    .collection-pills {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
      margin: 0 1.6rem 0.75rem;
      padding: 0.35rem 0;
      overflow-x: auto;
    }
    .collection-pills__pill {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.55rem 0.9rem;
      border-radius: 999px;
      border: 1px solid rgba(0, 0, 0, 0.14);
      background: #fff;
      color: #111;
      font-size: 0.9rem;
      letter-spacing: 0.01em;
      text-decoration: none;
      white-space: nowrap;
      transition: all 0.16s ease;
    }
    .collection-pills__pill:hover {
      border-color: rgba(0, 0, 0, 0.3);
      transform: translateY(-1px);
    }
    .collection-pills__pill.is-active {
      background: #111;
      color: #fff;
      border-color: #111;
    }
    .collection-pills__pill.is-active:hover {
      background: #000;
      border-color: #000;
    }
    @media (max-width: 749px) {
      .collection-pills {
        margin-inline: 1.2rem;
        padding-inline: 0.25rem;
      }
    }
    /* Hide built-in active facet chip for product_type so only custom pills show */
    .active-facets__button[data-filter-param="filter.p.product_type"] {
      display: none !important;
    }
    /* Hide clear-all link when the only active filter is product_type (desktop + mobile) */
    .active-facets__button-remove.underlined-link {
      display: none !important;
    }
    .mobile-facets__clear.underlined-link {
      display: none !important;
    }
  </style>

  <div class="collection-pills" role="list">
    {%- for pill_value in pill_items limit: 12 -%}
      {%- assign pill_label = pill_value -%}

      {%- assign href = collection.url | append: '?filter.p.product_type=' | append: pill_value | url_encode -%}
      {%- assign active = false -%}

      {%- if product_type_filter and product_type_filter.values -%}
        {%- assign match = nil -%}
        {%- for option in product_type_filter.values -%}
          {%- assign option_label_down = option.label | downcase -%}
          {%- assign option_value_down = option.value | downcase -%}
          {%- assign target_down = pill_value | downcase -%}
          {%- if option_label_down == target_down or option_value_down == target_down -%}
            {%- assign match = option -%}
            {%- break -%}
          {%- endif -%}
        {%- endfor -%}

        {%- if match -%}
          {%- assign href = match.url_to_add -%}
          {%- assign active = match.active -%}
          {%- if active -%}
            {%- assign href = match.url_to_remove -%}
          {%- endif -%}
        {%- endif -%}
      {%- endif -%}

      <a
        class="collection-pills__pill{% if active %} is-active{% endif %}"
        href="{{ href }}"
        role="listitem"
        aria-pressed="{{ active | default: false }}"
      >
        {{ pill_label | escape }}
      </a>
    {%- endfor -%}
  </div>
{% endif %}
