{{ 'component-size-guide.css' | asset_url | stylesheet_tag }}
<script src="{{ 'component-size-guide.js' | asset_url }}" defer="defer"></script>

{%- liquid
  assign size_guide_key = ''
  for tag in product.tags
    assign normalized_tag = tag | strip | downcase
    if normalized_tag contains 'size_guide_'
      assign size_guide_key = normalized_tag | remove: 'size_guide_'
      assign size_guide_key = size_guide_key | replace: ' ', '-'
      break
    endif
  endfor

  assign size_guide_rows_cm = nil
  assign size_guide_rows_in = nil
  assign size_guide_headers = 'Zona,S,M,L,XL' | split: ','
  assign size_guide_title = 'Dimensões do produto'
  assign size_guide_intro = 'As medidas podem apresentar pequenas variações devido ao processo de produção. A peça de roupa está medida esticada.'
  assign size_guide_helper_label = 'Consulta como medir a peça de roupa'
  assign size_guide_helper_url = '/pages/guia-de-tamanhos'

  case size_guide_key
    when 'hoodie'
      assign size_guide_rows_cm = 'Peito|61|63,5|66|68,5;Comprimento à frente|68,5|70|71,5|73;Comprimento da manga|64|65|66|67;Largura das costas|53|55,5|57,5|59,5;Largura do braço|26|27|27,5|28' | split: ';'
      assign size_guide_rows_in = 'Peito|24|25|26|27;Comprimento à frente|27|27,6|28,1|28,7;Comprimento da manga|25,2|25,6|26|26,4;Largura das costas|20,9|21,9|22,6|23,4;Largura do braço|10,2|10,6|10,8|11' | split: ';'
    when 'tshirt'
      assign size_guide_rows_cm = 'Peito|49|51|53|55;Comprimento|68|70|72|74;Comprimento da manga|20|21|22|23' | split: ';'
      assign size_guide_rows_in = 'Peito|19,3|20,1|20,9|21,7;Comprimento|26,8|27,6|28,3|29,1;Comprimento da manga|7,9|8,3|8,7|9,1' | split: ';'
    when 'pants'
      assign size_guide_headers = 'Zona,36,38,40,42' | split: ','
      assign size_guide_rows_cm = 'Cintura|72|76|80|84;Anca|94|98|102|106;Comprimento da perna|78|79|80|81' | split: ';'
      assign size_guide_rows_in = 'Cintura|28,3|29,9|31,5|33,1;Anca|37|38,6|40,2|41,7;Comprimento da perna|30,7|31,1|31,5|31,9' | split: ';'
  endcase

  assign default_unit = ''
  if size_guide_rows_cm
    assign default_unit = 'cm'
  elsif size_guide_rows_in
    assign default_unit = 'in'
  endif

  assign featured_media = product.media | where: 'media_type', 'image' | first
  if featured_media == blank
    assign featured_media = product.featured_media
  endif
  if featured_media
    assign size_guide_image_alt = featured_media.alt | default: product.title
  endif
-%}

<div class="size-guide" data-size-guide>
  <button
    type="button"
    class="size-guide__trigger"
    data-size-guide-open
    aria-haspopup="dialog"
    aria-expanded="false"
  >
    Guia de tamanhos
  </button>
  <div class="size-guide__overlay" data-size-guide-overlay></div>
  <aside
    class="size-guide__drawer"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
    tabindex="-1"
    data-size-guide-drawer
  >
    <div class="size-guide__header">
      <h2 class="size-guide__heading">{{ size_guide_title }}</h2>
      <button
        type="button"
        class="size-guide__close"
        aria-label="Fechar guia de tamanhos"
        data-size-guide-close
      >
        &times;
      </button>
    </div>
    <div class="size-guide__body">
      <p class="size-guide__intro">{{ size_guide_intro }}</p>
      {% if size_guide_helper_url != blank %}
        <a class="size-guide__helper-link" href="{{ size_guide_helper_url }}">{{ size_guide_helper_label }}</a>
      {% endif %}
      {% if featured_media %}
        <div class="size-guide__image">
          {{ featured_media | image_url: width: 600 | image_tag: loading: 'lazy', widths: '180,360,540,720', sizes: '(min-width: 750px) 360px, 80vw', alt: size_guide_image_alt }}
        </div>
      {% endif %}

      {% if size_guide_rows_cm or size_guide_rows_in %}
        {% if size_guide_rows_cm and size_guide_rows_in %}
          <div class="size-guide__unit-toggle" role="group" aria-label="Selecionar unidade de medida">
            <button
              type="button"
              class="size-guide__unit-btn{% if default_unit == 'cm' %} is-active{% endif %}"
              data-size-guide-unit="cm"
            >
              CM
            </button>
            <button
              type="button"
              class="size-guide__unit-btn{% if default_unit == 'in' %} is-active{% endif %}"
              data-size-guide-unit="in"
            >
              IN
            </button>
          </div>
        {% endif %}

        <div class="size-guide__tables">
          {% if size_guide_rows_cm %}
            <table
              class="size-guide__table{% if default_unit == 'cm' %} is-active{% endif %}"
              data-size-guide-table="cm"
            >
              <caption>Medidas em centímetros</caption>
              <thead>
                <tr>
                  {% for header in size_guide_headers %}
                    <th scope="col">{{ header }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for row in size_guide_rows_cm %}
                  {% assign values = row | split: '|' %}
                  {% if values.size > 0 %}
                    <tr>
                      {% for value in values %}
                        {% if forloop.first %}
                          <th scope="row">{{ value }}</th>
                        {% else %}
                          <td>{{ value }}</td>
                        {% endif %}
                      {% endfor %}
                    </tr>
                  {% endif %}
                {% endfor %}
              </tbody>
            </table>
          {% endif %}

          {% if size_guide_rows_in %}
            <table
              class="size-guide__table{% if default_unit == 'in' %} is-active{% endif %}"
              data-size-guide-table="in"
            >
              <caption>Medidas em polegadas</caption>
              <thead>
                <tr>
                  {% for header in size_guide_headers %}
                    <th scope="col">{{ header }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for row in size_guide_rows_in %}
                  {% assign values = row | split: '|' %}
                  {% if values.size > 0 %}
                    <tr>
                      {% for value in values %}
                        {% if forloop.first %}
                          <th scope="row">{{ value }}</th>
                        {% else %}
                          <td>{{ value }}</td>
                        {% endif %}
                      {% endfor %}
                    </tr>
                  {% endif %}
                {% endfor %}
              </tbody>
            </table>
          {% endif %}
        </div>
      {% else %}
        <p class="size-guide__empty-state">
          Adiciona uma tag no formato <code>size_guide_tipo</code> a este produto para mostrar uma tabela de medidas. Exemplos disponíveis: <code>size_guide_hoodie</code>, <code>size_guide_tshirt</code>, <code>size_guide_pants</code>.
        </p>
      {% endif %}
    </div>
  </aside>
</div>
