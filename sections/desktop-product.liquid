{% schema %}
{
  "name": "Desktop Product",
  "settings": [],
  "presets": [
    {
      "name": "Desktop Product"
    }
  ]
}
{% endschema %}

{% comment %}
  Create a dummy block object with default settings
{% endcomment %}
{% assign dummy_block = '{ "settings": { "picker_type": "button", "swatch_shape": "circle" }, "shopify_attributes": "" }' | parse_json %}

{% comment %}
  Include variant/swatch CSS if needed
{% endcomment %}
{% unless product.has_only_default_variant %}
  {{ 'component-product-variant-picker.css' | asset_url | stylesheet_tag }}
  {{ 'component-swatch.css' | asset_url | stylesheet_tag }}
{% endunless %}
{{ 'component-swatch-input.css' | asset_url | stylesheet_tag }}
{{ 'component-product-variant-picker.css' | asset_url | stylesheet_tag }}
{{ 'component-swatch.css' | asset_url | stylesheet_tag }}
{{ 'swatches-cheyenne.css' | asset_url | stylesheet_tag }}

<style>
  /* Hide this entire desktop section on mobile, to avoid conflict */
  @media screen and (max-width: 749px) {
    .desktop-product-section {
      display: none !important;
    }
    .footer-desktop {
      display: none;
    }
    .desktop-related-products {
      display: none;
    }
  }

  /* The 2-column layout for desktop */
  .desktop-product-section {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
    display: grid;
    grid-template-columns: 3fr 2fr; /* left media, right info */
    gap: 20px;
  }

  /* Left column: Thumbnails + a scrollable container for big images */
.desktop-product-media {
  display: flex; /* Two side-by-side blocks: thumbnails & big images container */
  gap: 10px;
}

/* Thumbnails: single column; all thumbnails are visible */
.desktop-product-media .thumbnail-list {
  list-style: none;
  padding: 0;
  margin: 0;
    display: flex;
    flex-direction: column; /* one column */
    gap: 10px;
    width: 80px; /* thumbnail column width */
    flex-shrink: 0; /* Prevent thumbnails from shrinking */
  }
  .desktop-product-media .thumbnail-list li {
    cursor: pointer;
    opacity: 0.6;
    transition: opacity 0.2s;
    box-sizing: border-box; /* Include border in width calculation */
    width: 80px; /* Fixed width for each thumbnail */
    height: 100px; /* 4:5 aspect ratio (80px * 1.25 = 100px) */
    overflow: hidden; /* Prevent overflow */
    border: 1px solid transparent; /* Placeholder border to prevent layout shift */
  }
  .desktop-product-media .thumbnail-list li:hover {
    opacity: 0.8;
  }
  .desktop-product-media .thumbnail-list li.active {
    opacity: 1;
    border: 1px solid #545454;
  }
  .desktop-product-media .thumbnail-list li img {
    width: 100%;
    height: 100%;
    display: block;
    object-fit: cover; /* Cover the container maintaining 4:5 aspect */
  }

  /* Scrollable container for big images (independent scroll) */
  .desktop-product-media .image-scroll-container {
    position: relative;
    width: 100%;
    max-width: 600px;
    height: 100vh;             /* Fill the viewport height */
    overflow-y: auto;          /* Independent scroll */
    scrollbar-width: none;     /* Hide scrollbar in Firefox */
    -ms-overflow-style: none;  /* Hide scrollbar in IE/Edge */
  }
  .desktop-product-media .image-scroll-container::-webkit-scrollbar {
    display: none; /* Hide scrollbar in Chrome, Safari, Opera */
  }

  /* The stacked big images inside the scrollable container */
  .desktop-product-media .main-images-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
    padding-bottom: 40px; /* extra space at bottom */
  }
  .desktop-product-media .main-image-slide img {
    width: 100%;
    height: auto;
    display: block;
    object-fit: contain;
  }

  /* Right column: Sticky Info */
  .desktop-product-info {
    position: sticky;
    top: 0;
    align-self: start;
    padding: 20px;
    padding-top: 0px;
    background: #fff;
  }

  /* Title styling */
  .desktop-product-info h1 {
    font-size: 20px;
    margin-bottom: 6px;
    font-weight: 300;
    letter-spacing: 0.08em !important;
    line-height: 1.2;
  }

  /* Price styling */
  .desktop-product-info .price--large {
    font-size: 18px;
    margin-bottom: 8px;
    font-weight: 300;
  }
  .desktop-product-info .price--on-sale .price-item--regular {
    color: rgba(0, 0, 0, 0.35);
    font-size: 14px;
  }
  .desktop-product-info .price--on-sale .price-item--sale {
    font-weight: 400;
  }

  /* Variant picker / Buy buttons spacing */
  .desktop-product-info .product-variants {
    margin: 24px 0;
  }
  .desktop-product-info .add-to-cart {
    margin-bottom: 14px;
  }

  /* Description styling */
  .desktop-product-info .product-description {
    line-height: 1.6;
    color: #333;
    margin-top: 8px;
    font-size: 13px;
  }

  /* Example sale price color/size changes */
  #shopify-section-template--24455438926148__desktop_product_kf6zNg > div > div.desktop-product-info > div.price-container > div > div > div.price__sale > span.price-item.price-item--sale.price-item--last {
    color: #ff6f61 ;
    font-weight: 400;
    font-size: 20px;
  }
  #shopify-section-template--24455438926148__desktop_product_kf6zNg > div > div.desktop-product-info > div.price-container > div > div > div.price__sale {
    background: transparent;
  }
  #shopify-section-template--24455438926148__desktop_product_kf6zNg > div > div.desktop-product-info > div.price-container > div > div > div.price__sale > span:nth-child(2) > s {
    color: #b3b3b3;
    font-size: 14px !important;
  }

  .price > * {
    display: inline-block;
  }

  /* Additional swatch / variant styling from previous code */
  @media screen and (min-width: 750px) {
    /* Hide the main product section's media gallery on desktop when desktop-product section is used */
    [id*="MediaGallery"][id*="main"] {
      display: none !important;
    }
  }

  /* Size swatch containers */
  .desktop-product-section fieldset.product-form__input--pill,
  .desktop-product-section fieldset[class*="product-form__input--pill"],
  [id*="variant-selects"] fieldset.product-form__input--pill,
  #variant-selects-template--24455438926148__desktop_product_kf6zNg > fieldset.js.product-form__input.product-form__input--pill {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 4px !important;
    align-items: center !important;
    margin-bottom: 20px !important;
  }

  /* Color swatch styling is now handled by global CSS in swatches-cheyenne.css */

  /* Swatch row with ruler styling */
  .swatch-row-with-ruler {
    display: flex !important;
    align-items: center !important;
    justify-content: flex-start !important;
    gap: 12px !important;
    flex-wrap: nowrap !important;
  }

  .swatch-row-with-ruler .product-form__input--swatch,
  .swatch-row-with-ruler > div:first-child {
    flex: 0 0 auto;
  }

  /* Size guide ruler button styling */
  .size-guide-ruler-btn {
    background: none !important;
    border: none !important;
    padding: 0 !important;
    cursor: pointer !important;
    display: flex !important;
    align-items: center !important;
    justify-content: flex-end !important;
    white-space: nowrap !important;
    font-size: 11px !important;
    text-decoration: underline !important;
    color: inherit !important;
    margin-left: auto !important;
    flex-shrink: 0 !important;
  }

  .size-guide-ruler-btn:hover {
    opacity: 0.7 !important;
  }

  /* Size swatch labels - smaller sizing */
  .desktop-product-section fieldset.product-form__input--pill label,
  .desktop-product-section fieldset[class*="product-form__input--pill"] label,
  [id*="variant-selects"] fieldset.product-form__input--pill label,
  #variant-selects-template--24455438926148__desktop_product_kf6zNg > fieldset.js.product-form__input.product-form__input--pill > label {
    padding: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    border: 1px solid #000 !important;
    cursor: pointer !important;
    margin: 0 !important;
    height: 24px !important;
    width: 24px !important;
    min-height: 24px !important;
    min-width: 24px !important;
    max-height: 24px !important;
    max-width: 24px !important;
    font-size: 12px !important;
    box-sizing: border-box !important;
    border-radius: 0 !important;
    flex-shrink: 0 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    position: relative !important;
    float: none !important;
    clear: none !important;
  }
  #shopify-section-template--24455438926148__desktop_product_kf6zNg > div > div.desktop-product-info > h1 {
    margin-top: 0px;
  }
  #shopify-section-template--24455438926148__desktop_product_kf6zNg > div > div.desktop-product-info {
    padding: 0px 0px 10px 10px;
  }
  #variant-selects-template--24455438926148__desktop_product_kf6zNg {
    border: none;
  }

  /* Fieldset borders top/bottom for size options */
  .product-form__input--pill {
    border: none;
  }
  fieldset.product-form__input--pill {
    border: none !important;
    border-bottom: 1px solid #ccc !important;
    padding: 20px 0px 40px 0;
  }
  /* Hide fieldset legends including Size label */
  .desktop-product-section fieldset.product-form__input--pill legend,
  .desktop-product-section legend.form__label,
  [id*="variant-selects"] fieldset.product-form__input--pill legend,
  [id*="variant-selects"] legend.form__label,
  #variant-selects-template--24455438926148__desktop_product_kf6zNg > fieldset.js.product-form__input.product-form__input--pill > legend {
    display: none !important;
  }

  .footer-desktop {
    margin-top: 10rem;
  }

  .desktop-product-info .product__title-link {
    text-decoration: none;
    color: inherit;
    margin: 0 0 10px 0;
    font-weight: 300;
    font-size: 20px;
    line-height: 1.3;
    margin-bottom: 0;
    font-family: "Work Sans";
    letter-spacing: 0.08em !important;
  }

  .desktop-product-title-wrapper {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 8px;
  }

  .desktop-product-title-wrapper h1 {
    flex: 1;
    margin: 0;
  }

  desktop-related-products {
    display: none;
  }

  h2.also {
    margin: 40px 40px 0px 16px;
    font-weight: 100;
    font-size: 20px;
    line-height: 1.3;
  }

  /* Active swatch styling is now handled by global CSS in component-product-variant-picker.css */

  /* Accordion CSS */
  .desktop-product-section .product-info-accordion {
    max-width: 600px;
    margin: 0 auto;
    margin-top: 8px;
  }
  .desktop-product-section .accordion-item {
    border-top: 1px solid rgba(0, 0, 0, 0.08);
  }
  .desktop-product-section .accordion-item:last-child {
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
  }
  .desktop-product-section .accordion-button {
    width: 100%;
    background: none;
    border: none;
    text-align: left;
    padding: 0.9rem 0;
    font-size: 13px;
    font-weight: 400;
    cursor: pointer;
    outline: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
    min-height: 44px;
  }
  .desktop-product-section .accordion-button::after {
    content: "";
    width: 6px;
    height: 6px;
    border-right: 1px solid currentColor;
    border-bottom: 1px solid currentColor;
    margin-left: auto;
    transform: rotate(45deg);
    transition: transform 0.2s ease;
  }
  .desktop-product-section .accordion-button[aria-expanded="true"]::after {
    transform: rotate(-135deg);
  }
  .desktop-product-section .accordion-content {
    max-height: 0;
    overflow: hidden;
    padding: 0;
    transition: max-height 0.3s ease, padding 0.3s ease;
  }
  .desktop-product-section .accordion-content p {
    margin: 0.8rem 0;
    font-size: 12px;
    font-weight: 400;
    line-height: 1.6;
  }
  .desktop-product-section .accordion-button[aria-expanded="true"] + .accordion-content {
    max-height: 200px;
    padding: 0 0 1rem;
  }

  @media screen and (min-width: 750px) {
    #ProductSubmitButton- {
      background: transparent!important;
      color: black!important;
      border: none!important;
      width: 100%;
    }
  }

.product-description-container {
  white-space: normal;        /* Allow normal wrapping */
  word-break: break-word;     /* Break long words if needed */
  overflow-wrap: break-word;  /* Additional fallback for older browsers */
  max-width: 100%;            /* Prevent container from exceeding its parent width */
}

#NewsletterForm--sections--24361744990532__footers_MJGUrj {
  margin-left: 10%;
}
.product-description-container.expanded {
  max-height: 9999px; /* Big enough to show all text */
}

.description-toggle {
  display: inline-block;
  margin-top: 5px;
  color: blue;
  text-decoration: underline;
  cursor: pointer;
}

#ContactFooter > div.newsletter-form__field-wrapper > div > label {
    margin-top: -29px;
    margin-left: -15px;
}

</style>

{% liquid
  assign featured_media = product.featured_media | default: product.featured_image
  if featured_media
    assign wishlist_image = featured_media | image_url: width: 360
  else
    assign wishlist_image = ''
  endif

  assign size_option_index = -1
  for option in product.options_with_values
    assign option_name = option.name | downcase
    if option_name == 'size' or option_name == 'tamanho'
      assign size_option_index = forloop.index0
      break
    endif
  endfor

  assign color_option_index = -1
  for option in product.options_with_values
    assign option_name = option.name | downcase
    if option_name == 'color' or option_name == 'cor' or option_name == 'colour'
      assign color_option_index = forloop.index0
      break
    endif
  endfor
%}

<div class="desktop-product-section">
  <!-- Left side: Thumbnails + Scrollable Big Images -->
  <div class="desktop-product-media">
    <!-- Thumbnails (vertical list) -->
    <ul class="thumbnail-list" id="ThumbnailList-{{ section.id }}">
      {% for media in product.media %}
        <li data-media-index="{{ forloop.index0 }}">
          {{ media | img_tag: '100x100', alt: media.alt }}
        </li>
      {% endfor %}
    </ul>

    <!-- Scrollable container for stacked big images -->
    <div class="image-scroll-container" id="ImageScrollContainer-{{ section.id }}">
      <div class="main-images-list" id="MainImages-{{ section.id }}">
        {% for media in product.media %}
          <div class="main-image-slide"
               id="Slide-{{ forloop.index0 }}"
               data-index="{{ forloop.index0 }}"
               data-media-id="{{ media.id }}">
            <img 
              src="{{ media | img_url: '1024x1024' }}" 
              alt="{{ media.alt | escape }}"
            >
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Right side: Sticky Info -->
  <div class="desktop-product-info">
    <!-- Title -->
    <div
      class="desktop-product-title-wrapper product-card-wrapper"
      data-product-handle="{{ product.handle }}"
      data-product-title="{{ product.title | escape }}"
      data-product-url="{{ product.url | escape }}"
      data-product-image="{{ wishlist_image | escape }}"
      data-product-price="{{ product.price | money_without_trailing_zeros | escape }}"
      data-variants='{{ product.variants | json | escape }}'
      data-size-index="{{ size_option_index }}"
      data-color-index="{{ color_option_index }}"
    >
      <h1>
        <a class="product__title-link" href="{{ product.url }}">{{ product.title }}</a>
      </h1>
      <button
        class="wishlist-toggle"
        type="button"
        aria-pressed="false"
        aria-label="{{ 'general.add_to_wishlist' | t | default: 'Add to wishlist' }}"
      >
        <img
          class="wishlist-toggle__icon wishlist-toggle__icon--empty"
          src="{{ 'empty-heart.svg' | asset_url }}"
          alt=""
        >
        <img
          class="wishlist-toggle__icon wishlist-toggle__icon--full"
          src="{{ 'full-heart.svg' | asset_url }}"
          alt=""
        >
      </button>
      <div class="card__media" style="display: none;">
        <div class="media media--transparent media--hover-effect">
            <img src="{{ product.featured_media | image_url: width: 533 }}"
                 alt="{{ product.featured_media.alt | escape }}"
                 loading="lazy"
                 width="533"
                 height="{{ 533 | divided_by: product.featured_media.aspect_ratio | round }}"
            >
        </div>
      </div>
    </div>

    <div data-wishlist-card-template style="display: none;">
      {% render 'card-product', card_product: product, skip_styles: true, include_card_product_script: false %}
    </div>

    <!-- Price -->
    <div class="price-container">
      {% render 'price', product: product, use_variant: true, show_badges: false, price_class: 'price--large' %}
    </div>

    <!-- Description container (will be filled by JS) -->
    <div class="product-description" id="DesktopDescContainer">{{ product.description }}</div>

    <!-- Size chart is now accessible via ruler icon next to color swatches -->
    <div style="display: none;">
      {% render 'size-chart-new', section_id: section.id %}
    </div>
    {% unless product.has_only_default_variant %}
      <!-- Variant Picker -->
      <div class="product-variants">
        {% render 'desktop-variant-picker',
          product: product,
          product_form_id: 'desktop-product-form-' | append: section.id,
          block: dummy_block
        %}

        
      </div>
    {% endunless %}

    <!-- Add to Cart Buttons -->
    <div class="add-to-cart">
      {% render 'buy-buttons',
          block: dummy_block,
          product: product,
          product_form_id: 'desktop-product-form-' | append: section.id,
          section_id: section.id,
          show_pickup_availability: false
      %}
    </div>

    <!-- Accordion -->
    <div class="product-info-accordion">
      {%- liquid
        # Composition content with fallback chain
        assign composition_content = product.metafields.custom.accordion_composition
        if composition_content == blank
          assign composition_content = settings.default_accordion_composition
        endif
        if composition_content == blank
          assign composition_content = '100% Algodão. Lavar à máquina a 30°C.'
        endif

        # Shipping content with fallback chain
        assign shipping_content = product.metafields.custom.accordion_shipping
        if shipping_content == blank
          assign shipping_content = settings.default_accordion_shipping
        endif
        if shipping_content == blank
          assign shipping_content = 'Entrega em 2-3 dias úteis. Trocas e devoluções até 30 dias.'
        endif

        # Availability content with fallback chain
        assign availability_content = product.metafields.custom.accordion_availability
        if availability_content == blank
          assign availability_content = settings.default_accordion_availability
        endif
        if availability_content == blank
          assign availability_content = 'Disponível em todas as lojas da região.'
        endif

        # Check if share should be shown
        assign show_share = product.metafields.custom.accordion_share_enabled
        if show_share == blank
          assign show_share = settings.default_accordion_show_share
          if show_share == blank
            assign show_share = true
          endif
        endif
      -%}

      {%- # Composition accordion -%}
      <div class="accordion-item">
        <button class="accordion-button" aria-expanded="false">
          Composição e cuidados
        </button>
        <div class="accordion-content">
          <p>{{ composition_content | newline_to_br }}</p>
        </div>
      </div>

      {%- # Shipping accordion -%}
      <div class="accordion-item">
        <button class="accordion-button" aria-expanded="false">
          Envios, trocas e devoluções
        </button>
        <div class="accordion-content">
          <p>{{ shipping_content | newline_to_br }}</p>
        </div>
      </div>

      {%- # Availability accordion -%}
      <div class="accordion-item">
        <button class="accordion-button" aria-expanded="false">
          Disponibilidade na loja
        </button>
        <div class="accordion-content">
          <p>{{ availability_content | newline_to_br }}</p>
        </div>
      </div>

      {%- # Size Guide accordion -%}
      {%- liquid
        assign _scope_id = section.id | default: product.id
        assign sg_id = 'sg-' | append: product.id | append: '-' | append: _scope_id
      -%}
      <div class="accordion-item">
        <button class="accordion-button size-guide-trigger" aria-expanded="false" data-sg-open="{{ sg_id }}">
          Guia de tamanhos
        </button>
      </div>

      {%- # Share accordion -%}
      {% if show_share %}
        <div class="accordion-item">
          <button class="accordion-button" aria-expanded="false">
            Partilhar
          </button>
          <div class="accordion-content">
            <p style="display: flex; gap: 1.2rem; align-items: center;">
              <a href="https://www.facebook.com/sharer/sharer.php?u={{ product.url | url_encode }}" target="_blank" rel="noopener noreferrer" aria-label="Partilhar no Facebook" style="display: inline-flex; width: 24px; height: 24px;">
                <span style="width: 24px; height: 24px;">{{ 'icon-facebook.svg' | inline_asset_content }}</span>
              </a>
              <a href="https://twitter.com/intent/tweet?url={{ product.url | url_encode }}&text={{ product.title | url_encode }}" target="_blank" rel="noopener noreferrer" aria-label="Partilhar no Twitter" style="display: inline-flex; width: 24px; height: 24px;">
                <span style="width: 24px; height: 24px;">{{ 'icon-twitter.svg' | inline_asset_content }}</span>
              </a>
              {% if settings.social_instagram_link != blank %}
                <a href="{{ settings.social_instagram_link }}" target="_blank" rel="noopener noreferrer" aria-label="Ver no Instagram" style="display: inline-flex; width: 24px; height: 24px;">
                  <span style="width: 24px; height: 24px;">{{ 'icon-instagram.svg' | inline_asset_content }}</span>
                </a>
              {% endif %}
              <button onclick="navigator.clipboard.writeText('{{ shop.url }}{{ product.url }}'); this.textContent='Copiado!'; setTimeout(() => this.textContent='Copiar link', 2000);" style="background: none; border: none; text-decoration: underline; cursor: pointer; padding: 0; font-size: inherit; color: inherit;">Copiar link</button>
            </p>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<div class="desktop-related-products">
  <h2 class="also" style="margin-bottom: 1em;">Talvez lhe possa interessar</h2>
  {% render 'random-collection-grid' %}
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {


  // =========================
  // Intersection Observer for stacked images in the scroll container
  // =========================
  var containerEl = document.getElementById('ImageScrollContainer-{{ section.id }}');
  var slidesContainer = document.getElementById('MainImages-{{ section.id }}');
  var thumbnailList = document.getElementById('ThumbnailList-{{ section.id }}');
  if (!containerEl || !slidesContainer || !thumbnailList) return;

  var slides = slidesContainer.querySelectorAll('.main-image-slide');
  var thumbs = thumbnailList.querySelectorAll('li');

  function clearActiveThumbnails() {
    thumbs.forEach(function(thumb) {
      thumb.classList.remove('active');
    });
  }

  // Intersection Observer with the "root" set to the scroll container
  var observerOptions = {
    root: containerEl,  // observe inside the containerEl
    rootMargin: '0px',
    threshold: 0.5 // highlight thumbnail when 50% of image is in view
  };

  var observer = new IntersectionObserver(function(entries) {
    entries.forEach(function(entry) {
      if (entry.isIntersecting) {
        var index = entry.target.getAttribute('data-index');
        clearActiveThumbnails();
        var matchingThumb = thumbnailList.querySelector('li[data-media-index="' + index + '"]');
        if (matchingThumb) {
          matchingThumb.classList.add('active');
        }
      }
    });
  }, observerOptions);

  slides.forEach(function(slide) {
    observer.observe(slide);
  });

  // Clicking a thumbnail → smooth-scroll to that image
  thumbnailList.addEventListener('click', function(e) {
    var clickedLi = e.target.closest('li');
    if (!clickedLi) return;
    var index = clickedLi.getAttribute('data-media-index');
    var targetSlide = slidesContainer.querySelector('.main-image-slide[data-index="' + index + '"]');
    if (targetSlide) {
      var offsetTop = targetSlide.offsetTop;
      containerEl.scrollTo({
        top: offsetTop,
        behavior: 'smooth'
      });
    }
  });

  // When scrolling over the thumbnails, scroll the image container with native speed
  thumbnailList.addEventListener('wheel', function(e) {
    e.preventDefault(); // Prevent default scrolling on the thumbnail list
    containerEl.scrollBy({
      top: e.deltaY,
      behavior: 'auto'
    });
  });
});
</script>

<!-- Variant ID Sync Script for Desktop -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  var productData = {{ product | json }};
  if (!productData.variants) {
    return;
  }
  
  var addToCartContainer = document.querySelector('.desktop-product-info .add-to-cart');
  if (!addToCartContainer) {
    return;
  }
  
  var buyButtonsForm = addToCartContainer.querySelector('form');
  if (!buyButtonsForm) {
    return;
  }
  
  var hiddenInput = buyButtonsForm.querySelector('input[name="id"]');
  if (!hiddenInput) {
    return;
  }
  
  var variantPickerEl = document.getElementById('variant-selects-{{ section.id }}');
  if (!variantPickerEl) {
    return;
  }
  
  var optionWrappers = variantPickerEl.querySelectorAll('.product-form__input');
  if (!optionWrappers.length) {
    return;
  }

  var optionCount = Array.isArray(productData.options) ? productData.options.length : 0;

  function getSelectedOptions() {
    var selected = new Array(optionCount).fill(null);

    optionWrappers.forEach(function(wrapper) {
      var positionAttr = wrapper.getAttribute('data-option-position');
      if (!positionAttr) {
        return;
      }

      var index = parseInt(positionAttr, 10) - 1;
      if (isNaN(index) || index < 0 || index >= selected.length) {
        return;
      }

      var select = wrapper.querySelector('select');
      if (select) {
        if (select.value !== "") {
          selected[index] = select.value.trim();
        }
      } else {
        var radios = wrapper.querySelectorAll('input[type="radio"]');
        var found = false;
        radios.forEach(function(radio) {
          if (radio.checked) {
            selected[index] = radio.value.trim();
            found = true;
          }
        });
      }
    });
    return selected;
  }

  function findVariant(selectedOptions) {
    return productData.variants.find(function(variant) {
      return variant.options.every(function(opt, idx) {
        if (selectedOptions[idx] === null || selectedOptions[idx] === undefined || selectedOptions[idx] === '') {
          return true;
        }
        return String(selectedOptions[idx]).toLowerCase() === String(opt).toLowerCase();
      });
    });
  }
  
  function updateVariant() {
    var selectedOptions = getSelectedOptions();
    var matchingVariant = findVariant(selectedOptions);
    if (matchingVariant) {
      hiddenInput.value = matchingVariant.id;
      hiddenInput.dispatchEvent(new Event('change', { bubbles: true }));
      
      // If the variant has a featured_media, scroll the slider to its image
      if (matchingVariant.featured_media && matchingVariant.featured_media.id) {
        var containerEl = document.getElementById('ImageScrollContainer-{{ section.id }}');
        var slidesContainer = document.getElementById('MainImages-{{ section.id }}');
        if (containerEl && slidesContainer) {
          var targetSlide = slidesContainer.querySelector('.main-image-slide[data-media-id="' + matchingVariant.featured_media.id + '"]');
          if (targetSlide) {
            containerEl.scrollTo({
              top: targetSlide.offsetTop,
              behavior: 'smooth'
            });
          }
        }
      }
    } else {
    }
  }
  
  optionWrappers.forEach(function(wrapper) {
    var elements = wrapper.querySelectorAll('input, select');
    elements.forEach(function(el) {
      el.addEventListener('change', function() {
        updateVariant();
        updatePrice();
      });
    });
  });

  // Function to update the price display when variant changes
  function updatePrice() {
    var selectedOptions = getSelectedOptions();
    var matchingVariant = findVariant(selectedOptions);
    
    if (!matchingVariant) {
      return;
    }
    
    
    var priceContainer = document.querySelector('.desktop-product-info .price-container .price');
    if (!priceContainer) {
      return;
    }
    
    var hasComparePrice = matchingVariant.compare_at_price && matchingVariant.compare_at_price > matchingVariant.price;
    
    
    // Update the price container classes
    if (hasComparePrice) {
      priceContainer.classList.add('price--on-sale');
      priceContainer.classList.remove('price--sold-out');
    } else {
      priceContainer.classList.remove('price--on-sale');
      if (!matchingVariant.available) {
        priceContainer.classList.add('price--sold-out');
      }
    }
    
    // Format prices properly - prices in Shopify are in cents
    var priceInCents = matchingVariant.price;
    var compareAtPriceInCents = matchingVariant.compare_at_price || 0;
    
    // Update regular price (shown when NOT on sale)
    var regularPriceEl = priceContainer.querySelector('.price__regular .price-item--regular');
    if (regularPriceEl) {
      regularPriceEl.textContent = formatPrice(priceInCents);
    }
    
    // Update sale price (shown when on sale)
    var salePriceEl = priceContainer.querySelector('.price__sale .price-item--sale');
    if (salePriceEl) {
      salePriceEl.textContent = formatPrice(priceInCents);
    }
    
    // Update compare at price (strikethrough price when on sale)
    var compareAtEls = priceContainer.querySelectorAll('.price__sale s.price-item--regular');
    compareAtEls.forEach(function(el) {
      if (compareAtPriceInCents > 0) {
        el.textContent = formatPrice(compareAtPriceInCents);
      }
    });
  }
  
  // Helper function to format price from cents to euros
  function formatPrice(priceInCents) {
    var euros = priceInCents / 100;
    return euros.toFixed(2).replace('.', ',') + '€';
  }

  updateVariant();
  updatePrice();
});
</script>

<!-- Swatch Active State Script for Desktop -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  var swatchFieldsets = document.querySelectorAll('.product-form__input--swatch');
  swatchFieldsets.forEach(function(fieldset) {
    var radios = fieldset.querySelectorAll('input[type="radio"]');
    
    // Mark whichever is checked by default
    radios.forEach(function(radio) {
      if (radio.checked) {
        radio.nextElementSibling.classList.add('active');
      }
    });
    
    // If none is checked, check the first radio & set it active
    var hasChecked = fieldset.querySelector('input[type="radio"]:checked');
    if (!hasChecked && radios.length > 0) {
      radios[0].checked = true;
      radios[0].nextElementSibling.classList.add('active');
    }
    
    // Whenever a radio changes, remove .active from all labels, then add it to the changed radio's label
    radios.forEach(function(radio) {
      radio.addEventListener('change', function() {
        fieldset.querySelectorAll('label').forEach(function(label) {
          label.classList.remove('active');
        });
        var label = radio.nextElementSibling;
        if (label) {
          label.classList.add('active');
        }
      });
    });
  });
});
</script>

<!-- Accordion Script -->
<script>
  // Get all accordion buttons
  const accordionButtons = document.querySelectorAll('.accordion-button');

  accordionButtons.forEach((button) => {
    button.addEventListener('click', () => {
      // Skip size guide accordion - it's handled by the drawer
      if (button.hasAttribute('data-sg-open')) {
        return;
      }

      // Toggle the "aria-expanded" attribute
      const expanded = button.getAttribute('aria-expanded') === 'true' || false;
      button.setAttribute('aria-expanded', !expanded);

      // (Optional) Close other accordions if you want only one open at a time
      // accordionButtons.forEach((otherBtn) => {
      //   if (otherBtn !== button) {
      //     otherBtn.setAttribute('aria-expanded', false);
      //   }
      // });
    });
  });
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const product = {{ product | json }};
  const titleWrapper = document.querySelector('.desktop-product-title-wrapper');
  const variantPicker = document.querySelector('variant-radios, variant-selects');

  if (titleWrapper && variantPicker) {
    variantPicker.addEventListener('change', function() {
      const currentVariant = product.variants.find(v => v.id == variantPicker.variant.id);
      if (currentVariant && currentVariant.featured_image) {
        titleWrapper.dataset.productImage = currentVariant.featured_image.src;
      }
    });
  }
});
</script>
